<!DOCTYPE html>
<html lang="it">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1.0,maximum-scale=1.0,user-scalable=no">
<meta name="apple-mobile-web-app-title" content="Budget Pro">
<meta name="theme-color" content="#2c3e50">
<meta name="description" content="Gestisci il tuo budget personale in modo semplice ed efficace">
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Red+Hat+Display:wght@400;500;600;700;800;900&display=swap" rel="stylesheet">
<title>Budget Manager Pro - Obsidian Amber</title>
<link rel="stylesheet" href="css/styles.css">
</head>
<body>

<!-- SCHERMATA LOGIN DARK ELEGANT -->
<div id="loginScreen" style="position:fixed;top:0;left:0;right:0;bottom:0;background:linear-gradient(135deg,#0a0e27 0%,#16213e 100%);z-index:99999;display:flex;align-items:center;justify-content:center;font-family:-apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,sans-serif">
<div style="background:rgba(255,255,255,0.05);backdrop-filter:blur(10px);border:3px solid rgba(255,215,0,0.3);border-radius:24px;padding:50px 40px;max-width:400px;width:90%;text-align:center;box-shadow:0 20px 60px rgba(0,0,0,0.6);animation:fadeIn 0.5s ease-out">
<div style="font-size:4em;margin-bottom:25px;animation:bounce 1s ease-in-out;filter:drop-shadow(0 0 15px rgba(229,228,226,0.5))">ğŸ”</div>
<div style="text-align:center;line-height:1.2;margin-bottom:8px">
<div style="font-size:1.6em;font-weight:700;color:#e5e4e2;letter-spacing:3px;text-shadow:0 0 12px rgba(229,228,226,0.3);margin-bottom:5px">BUDGET</div>
<div style="font-size:1.3em;font-weight:900;color:#808080;letter-spacing:4px;text-shadow:0 0 10px rgba(128,128,128,0.3)">MANAGER PRO</div>
</div>
<p style="color:#b0c4de;margin:0 0 35px 0;font-size:0.95em;font-weight:500">Finanze personali</p>

<form onsubmit="handleLogin(event); return false;" style="width:100%">
<input type="password" id="loginPassword" placeholder="Password" required autofocus autocomplete="off" style="width:100%;padding:16px;background:rgba(255,255,255,0.08);border:3px solid rgba(255,215,0,0.3);border-radius:12px;font-size:1.1em;margin-bottom:15px;text-align:center;box-sizing:border-box;transition:all 0.3s;outline:none;color:#fff;font-weight:600" onfocus="this.style.borderColor='rgba(255,215,0,0.6)';this.style.background='rgba(255,255,255,0.12)'" onblur="this.style.borderColor='rgba(255,215,0,0.3)';this.style.background='rgba(255,255,255,0.08)'">

<label style="display:flex;align-items:center;justify-content:center;gap:8px;margin-bottom:20px;cursor:pointer;user-select:none">
<input type="checkbox" id="rememberDevice" style="width:20px;height:20px;cursor:pointer;accent-color:#e5e4e2">
<span style="color:#e5e4e2;font-size:0.95em;font-weight:700">ğŸ” Ricorda password su questo dispositivo</span>
</label>

<button type="button" onclick="handleLogin(event)" style="width:100%;background:linear-gradient(135deg,#e5e4e2,#ffa500);color:#16213e;border:none;padding:16px;border-radius:12px;font-size:1.1em;font-weight:800;cursor:pointer;transition:all 0.3s;box-shadow:0 6px 20px rgba(255,215,0,0.4)" onmouseover="this.style.transform='translateY(-2px)';this.style.boxShadow='0 8px 25px rgba(255,215,0,0.6)'" onmouseout="this.style.transform='translateY(0)';this.style.boxShadow='0 6px 20px rgba(255,215,0,0.4)'">
âœ¨ Accedi
</button>
</form>

<div id="loginError" style="margin-top:20px;padding:12px;background:rgba(242,54,69,0.2);border:2px solid #f23645;border-radius:8px;color:#f23645;font-weight:700;display:none">
âŒ <span id="errorMsg">Password errata</span>
</div>

<div style="margin-top:30px;padding-top:20px;border-top:2px solid rgba(255,215,0,0.2)">
<p style="color:#787b86;font-size:0.85em;margin:0">ğŸ”’ I tuoi dati sono protetti e privati</p>
</div>
</div>
</div>




<div class="header">
<div class="hdr-row">
<h1>ğŸ’° Budget Manager Pro</h1>
</div>
</div>

<div class="content">
<div id="dash" class="section active">

<!-- Selettori Anno e Mese SOPRA PATRIMONIO - SPAZIATURA UGUALE -->
<div style="display:flex;justify-content:center;align-items:center;gap:8px;margin-top:20px;margin-bottom:20px;overflow-x:auto;padding:0 10px">
<!-- Anno -->
<select id="year" onchange="aggiorna()" style="background:rgba(255,255,255,0.15);border:2px solid rgba(255,215,0,0.4);color:#e5e4e2;padding:10px 16px;border-radius:10px;font-size:0.95em;font-weight:700;cursor:pointer;min-width:85px;flex-shrink:0">
</select>

<!-- Mese -->
<select id="month" onchange="aggiorna()" style="background:rgba(255,255,255,0.15);border:2px solid rgba(255,215,0,0.4);color:#e5e4e2;padding:10px 16px;border-radius:10px;font-size:0.95em;font-weight:700;cursor:pointer;min-width:115px;flex-shrink:0">
<option value="0">Gennaio</option>
<option value="1">Febbraio</option>
<option value="2">Marzo</option>
<option value="3">Aprile</option>
<option value="4">Maggio</option>
<option value="5">Giugno</option>
<option value="6">Luglio</option>
<option value="7">Agosto</option>
<option value="8">Settembre</option>
<option value="9">Ottobre</option>
<option value="10">Novembre</option>
<option value="11">Dicembre</option>
</select>

<!-- Button Oggi -->
<button onclick="vaiOggi()" style="background:rgba(255,255,255,0.2);border:2px solid rgba(255,255,255,0.3);color:#fff;padding:10px 16px;border-radius:10px;cursor:pointer;font-weight:700;font-size:0.95em;white-space:nowrap;flex-shrink:0">ğŸ“… Oggi</button>
</div>

<!-- PATRIMONIO + CONTI DETTAGLIATI -->
<div class="card" style="background:linear-gradient(135deg, #a1a1aa 0%, #71717a 100%);border:none;padding:25px;box-shadow:0 8px 24px rgba(102,126,234,0.3)">
<!-- Patrimonio GRANDE in alto -->
<div style="text-align:center;margin-bottom:20px">
<div style="font-size:0.9em;color:rgba(255,255,255,0.85);font-weight:600;margin-bottom:8px;letter-spacing:0.5px">ğŸ’ PATRIMONIO TOTALE</div>
<div style="font-size:3em;font-weight:900;color:#fff;line-height:1" id="pat">â‚¬0</div>
</div>

<!-- Separatore -->
<div style="height:1px;background:rgba(255,255,255,0.2);margin:20px 0"></div>

<!-- Composizione Dettagliata Conti -->
<div style="background:rgba(255,255,255,0.1);padding:18px;border-radius:12px;backdrop-filter:blur(10px)">
<div style="font-size:0.85em;color:rgba(255,255,255,0.9);font-weight:700;margin-bottom:15px;text-align:center;letter-spacing:0.5px">ğŸ’³ COMPOSIZIONE PATRIMONIO</div>

<div id="composizioneConti">
<!-- Popolato da JavaScript -->
</div>
</div>
</div>

<!-- Bottoni Navigazione Mese (nascosti o rimossi) -->
<div style="display:none">
<button onclick="cambiaPatrimonioMese(-1)" style="background:rgba(229,228,226,0.15);border:2px solid rgba(255,140,0,0.6);color:#a1a1aa;box-shadow:0 2px 8px rgba(255,140,0,0.1);padding:12px 20px;border-radius:10px;cursor:pointer;font-weight:700;font-size:1em">â—€ Mese Prec</button>
<button id="oggiDashboard" onclick="vaiOggi()" style="background:rgba(229,228,226,0.15);border:2px solid rgba(255,140,0,0.6);color:#a1a1aa;box-shadow:0 2px 8px rgba(255,140,0,0.1);padding:12px 20px;border-radius:10px;cursor:pointer;font-weight:700;font-size:1em">ğŸ“… Oggi</button>
<button onclick="cambiaPatrimonioMese(1)" style="background:rgba(229,228,226,0.15);border:2px solid rgba(255,140,0,0.6);color:#a1a1aa;box-shadow:0 2px 8px rgba(255,140,0,0.1);padding:12px 20px;border-radius:10px;cursor:pointer;font-weight:700;font-size:1em">Mese Succ â–¶</button>
</div>

<!-- Alert Dashboard -->
<div id="dashboardAlerts"></div>

<div class="metrics">
<div class="metric">
<h4 style="color:var(--income);text-align:center">ğŸ“ˆ Entrate</h4>
<div class="val" style="color:var(--income)" id="ent">â‚¬0</div>
</div>
<div class="metric">
<h4 style="color:var(--expense);text-align:center">ğŸ“‰ Uscite Totali</h4>
<div class="val" style="color:var(--expense)" id="usc">â‚¬0</div>
</div>
<div class="metric metric-full">
<h4 style="color:#3b82f6;text-align:center">ğŸ’° Saldo Mensile</h4>
<div class="val" style="color:#3b82f6" id="saldo">â‚¬0</div>
</div>
</div>

<!-- BREAKDOWN ENTRATE (COLLAPSIBLE) -->
<div class="card" style="background:linear-gradient(135deg, #e8f5e9 0%, #c8e6c9 100%);border:2px solid #4caf50;padding:0;overflow:hidden">
<div onclick="toggleBreakdownEntrate()" style="padding:18px 20px;cursor:pointer;display:flex;justify-content:center;align-items:center;user-select:none;position:relative">
<h3 style="margin:0;font-size:1em;color:#2e7d32;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;text-align:center">ğŸ’° Dettaglio Entrate - <span id="breakdownEntrateMonth" style="color:#2e7d32;font-weight:800"></span></h3>
<span id="breakdownEntrateToggleIcon" style="font-size:1.5em;color:#2e7d32;transition:transform 0.3s;transform:rotate(-90deg);position:absolute;right:20px">â–¼</span>
</div>

<div id="breakdownEntrateContent" style="max-height:0;overflow:hidden;transition:max-height 0.3s ease-out">
<div style="padding:0 12px 15px 12px">
<!-- Totale Entrate Grande -->
<div style="background:rgba(255,255,255,0.95);padding:18px;border-radius:12px;margin-bottom:15px;text-align:center;border:2px solid #4caf50">
<div style="font-size:0.8em;color:#2e7d32;font-weight:600;margin-bottom:6px">ğŸ’µ TOTALE ENTRATE</div>
<div style="font-size:2.2em;font-weight:900;color:#2e7d32" id="breakdownEntrateTotale">â‚¬0</div>
</div>

<!-- Lista Entrate per Categoria -->
<div id="breakdownEntrateList" style="background:rgba(255,255,255,0.95);border-radius:12px;padding:15px">
<!-- SarÃ  popolato via JavaScript -->
</div>

<!-- Mini Grafico -->
<div style="background:rgba(255,255,255,0.95);padding:15px;border-radius:12px;margin-top:12px">
<div style="font-size:0.9em;font-weight:700;color:#2e7d32;margin-bottom:12px">ğŸ“Š Trend Ultimi 6 Mesi</div>
<canvas id="incomeComparisonChart" style="max-height:200px"></canvas>
</div>
</div>
</div>
</div>

<!-- WIDGET OBIETTIVI COMPATTO -->
<div class="card" style="background:linear-gradient(135deg, #fff3e0 0%, #ffe0b2 100%);border:2px solid #ff9800;padding:20px">
<div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:15px">
<h3 style="margin:0;font-size:1.1em;color:#e65100;text-align:center">ğŸ¯ I Tuoi Obiettivi</h3>
<button onclick="vai('obiettivi', event.target)" style="background:rgba(255,255,255,0.9);color:#e65100;border:2px solid #e65100;padding:8px 14px;border-radius:8px;font-size:0.85em;font-weight:700;cursor:pointer">Vedi Tutti â†’</button>
</div>

<div id="widgetObiettiviCompatto">
<!-- SarÃ  popolato via JavaScript -->
</div>

<div style="margin-top:12px;padding:12px;background:rgba(255,255,255,0.8);border-radius:8px;text-align:center;font-size:0.85em;color:#7f8c8d">
ğŸ’¡ Vai alla sezione Obiettivi per gestire tutto
</div>
</div>

<!-- SPESE CONDIVISE DETTAGLIATE (COLLAPSIBLE) -->
<div class="card" style="background:linear-gradient(135deg, #f3e5f5 0%, #e1bee7 100%);border:2px solid #9c27b0;padding:0;overflow:hidden">
<div onclick="toggleCondiviso()" style="padding:20px;cursor:pointer;display:flex;justify-content:center;align-items:center;user-select:none;position:relative">
<h3 style="margin:0;font-size:1.05em;color:#7b1fa2;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;text-align:center">ğŸ‘¥ Spese Condivise - <span id="sharedMonth" style="color:#7b1fa2;font-weight:800"></span></h3>
<span id="condivisoToggleIcon" style="font-size:1.5em;color:#9c27b0;transition:transform 0.3s;transform:rotate(-90deg);position:absolute;right:20px">â–¼</span>
</div>

<div id="condivisoContent" style="max-height:0;overflow:hidden;transition:max-height 0.3s ease-out">
<div style="padding:0 12px 15px 12px">
<!-- Metriche Mensili -->
<div style="background:rgba(255,255,255,0.9);padding:15px;border-radius:12px;margin-bottom:15px">
<h4 style="font-size:0.95em;color:#666;margin-bottom:12px;font-weight:600;text-align:center">ğŸ“… Questo Mese</h4>
<div style="display:grid;grid-template-columns:repeat(2,1fr);gap:12px;margin-bottom:12px">
<div style="text-align:center;padding:12px;background:linear-gradient(135deg,#e3f2fd,#bbdefb);border-radius:10px;border:2px solid #2196f3">
<div style="font-size:0.75em;color:#1976d2;font-weight:600;margin-bottom:4px">ğŸ’³ Tue Condivise</div>
<div style="font-size:1.3em;font-weight:800;color:#1565c0" id="tueSpeseCondiviseMese">â‚¬0</div>
<div style="font-size:0.7em;color:#1976d2;margin-top:2px" id="tueSpeseCondiviseCount">0 transazioni</div>
</div>
<div style="text-align:center;padding:12px;background:linear-gradient(135deg,#f3e5f5,#e1bee7);border-radius:10px;border:2px solid #9c27b0">
<div style="font-size:0.75em;color:#7b1fa2;font-weight:600;margin-bottom:4px">ğŸ‘¤ Sue Condivise</div>
<div style="font-size:1.3em;font-weight:800;color:#6a1b9a" id="sueSpeseCondiviseMese">â‚¬0</div>
<div style="font-size:0.7em;color:#7b1fa2;margin-top:2px" id="sueSpeseCondiviseCount">0 transazioni</div>
</div>
</div>
<div style="text-align:center;padding:12px;background:linear-gradient(135deg,#fff3e0,#ffe0b2);border-radius:10px;border:2px solid #ff9800;margin-bottom:8px">
<div style="font-size:0.75em;color:#e65100;font-weight:600;margin-bottom:4px">ğŸ  Totale Speso Insieme</div>
<div style="font-size:1.5em;font-weight:800;color:#e65100" id="totaleCondivisoMese">â‚¬0</div>
</div>
<div style="text-align:center;padding:12px;background:linear-gradient(135deg,#e8f5e9,#c8e6c9);border-radius:10px;border:2px solid #4caf50" id="daRecuperareMeseCard">
<div style="font-size:0.75em;font-weight:600;margin-bottom:4px" id="daRecuperareMeseLabel">ğŸ’° Da Recuperare Mese</div>
<div style="font-size:1.5em;font-weight:800" id="daRecuperareMese">â‚¬0</div>
<div style="font-size:0.7em;margin-top:4px;opacity:0.8" id="daRecuperareMeseExpl"></div>
</div>
</div>

<!-- Separatore -->
<div style="height:2px;background:linear-gradient(90deg,transparent,#9c27b0,transparent);margin:15px 0"></div>

<!-- Bilancio Cumulativo -->
<div style="background:rgba(255,255,255,0.9);padding:15px;border-radius:12px">
<h4 style="font-size:0.95em;color:#7b1fa2;margin-bottom:12px;font-weight:600;text-align:center">ğŸ“Š Bilancio Cumulativo</h4>
<div id="daRecuperareCumulativoCard" style="text-align:center;padding:20px;background:linear-gradient(135deg,#9c27b0,#7b1fa2);border-radius:12px;box-shadow:0 6px 20px rgba(156,39,176,0.4)">
<div id="daRecuperareCumulativoLabel" style="font-size:0.8em;color:#fff;opacity:0.9;margin-bottom:6px">ğŸ’° Da Recuperare TOTALE</div>
<div style="font-size:2em;font-weight:800;color:#fff;margin-bottom:4px" id="daRecuperare">â‚¬0</div>
<div style="font-size:0.75em;color:#fff;opacity:0.8" id="daRecuperarePeriodo">Dall'inizio tracking</div>
</div>
<button onclick="vai('condiviso', event.target)" class="btn" style="margin-top:12px;width:100%;background:linear-gradient(135deg,#f093fb,#f5576c);box-shadow:0 4px 12px rgba(245,87,108,0.3)">
ğŸ“… Vedi Storico Completo & Grafici
</button>
</div>
</div>
</div>
</div>

<!-- Rimuovo metriche vecchie -->
<div class="metrics" style="display:none">
<div class="metric">
<h4 style="color:#9b59b6;text-align:center">ğŸ‘¥ Spesa Partner</h4>
<div class="val" style="color:#9b59b6" id="leiHaPagato">â‚¬0</div>
</div>
<div class="metric">
<h4 style="color:#e74c3c;text-align:center">ğŸ’‘ Totale Condiviso</h4>
<div class="val" style="color:#e74c3c" id="speseCondivise">â‚¬0</div>
</div>
<div class="metric metric-full">
<h4 id="daRecuperareLabel" style="color:#f39c12;text-align:center">ğŸ’° Da Recuperare</h4>
<div class="val" style="color:#f39c12" id="daRecuperareOld">â‚¬0</div>
</div>
</div>

<!-- DISTRIBUTION BY CATEGORY -->
<div class="card">
<h3 style="margin-bottom:15px;font-size:1.05em;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;text-align:center">ğŸ“Š Distribuzione Spese per Categoria</h3>

<!-- TABS -->
<div style="display:flex;gap:8px;margin-bottom:15px;overflow-x:auto;-webkit-overflow-scrolling:touch">
<button id="distribTabMese" onclick="cambiaDistribTab('mese')" style="flex:1;min-width:80px;padding:10px 12px;background:linear-gradient(135deg,#a1a1aa,#71717a);color:#fff;border:none;border-radius:10px;font-weight:700;font-size:0.9em;cursor:pointer;transition:all 0.3s;white-space:nowrap">ğŸ“… Mese</button>
<button id="distribTabAnno" onclick="cambiaDistribTab('anno')" style="flex:1;min-width:80px;padding:10px 12px;background:var(--card);color:var(--text);border:2px solid var(--border);border-radius:10px;font-weight:700;font-size:0.9em;cursor:pointer;transition:all 0.3s;white-space:nowrap">ğŸ“† Anno</button>
<button id="distribTabCustom" onclick="cambiaDistribTab('custom')" style="flex:1;min-width:80px;padding:10px 12px;background:var(--card);color:var(--text);border:2px solid var(--border);border-radius:10px;font-weight:700;font-size:0.9em;cursor:pointer;transition:all 0.3s;white-space:nowrap">ğŸ¯ Range</button>
</div>

<!-- SELETTORE PERIODO -->
<div id="distribPeriodoMese" style="margin-bottom:15px">
<div style="background:linear-gradient(135deg,rgba(102,126,234,0.1),rgba(118,75,162,0.1));padding:15px;border-radius:12px;border:2px solid rgba(102,126,234,0.3)">
<label style="display:block;font-size:0.95em;color:var(--text);margin-bottom:10px;font-weight:700;text-align:center">
<span style="font-size:1.3em">ğŸ“…</span> Seleziona Mese
</label>
<select id="distribMeseSelect" onchange="aggiornaDistribuzione()" style="width:100%;padding:14px 16px;border:2px solid #a1a1aa;border-radius:10px;font-size:1em;background:#fff;color:#2c3e50;font-weight:600;cursor:pointer;transition:all 0.3s;box-shadow:0 2px 8px rgba(102,126,234,0.15);text-align:center" onfocus="this.style.borderColor='#71717a';this.style.boxShadow='0 4px 12px rgba(118,75,162,0.3)'" onblur="this.style.borderColor='#a1a1aa';this.style.boxShadow='0 2px 8px rgba(102,126,234,0.15)'">
<!-- Popolato dinamicamente -->
</select>
</div>
</div>

<div id="distribPeriodoAnno" style="margin-bottom:15px;display:none">
<div style="background:linear-gradient(135deg,rgba(102,126,234,0.1),rgba(118,75,162,0.1));padding:15px;border-radius:12px;border:2px solid rgba(102,126,234,0.3)">
<label style="display:flex;align-items:center;gap:8px;font-size:0.95em;color:var(--text);margin-bottom:10px;font-weight:700">
<span style="font-size:1.3em">ğŸ“†</span>
<span>Seleziona Anno</span>
</label>
<select id="distribAnnoSelect" onchange="aggiornaDistribuzione()" style="width:100%;padding:14px 16px;border:2px solid #a1a1aa;border-radius:10px;font-size:1em;background:#fff;color:#2c3e50;font-weight:600;cursor:pointer;transition:all 0.3s;box-shadow:0 2px 8px rgba(102,126,234,0.15)" onfocus="this.style.borderColor='#71717a';this.style.boxShadow='0 4px 12px rgba(118,75,162,0.3)'" onblur="this.style.borderColor='#a1a1aa';this.style.boxShadow='0 2px 8px rgba(102,126,234,0.15)'">
<!-- Popolato dinamicamente -->
</select>
</div>
</div>

<div id="distribPeriodoCustom" style="margin-bottom:15px;display:none">
<div style="background:linear-gradient(135deg,rgba(102,126,234,0.1),rgba(118,75,162,0.1));padding:15px;border-radius:12px;border:2px solid rgba(102,126,234,0.3)">
<label style="display:flex;align-items:center;gap:8px;font-size:0.95em;color:var(--text);margin-bottom:10px;font-weight:700">
<span style="font-size:1.3em">ğŸ¯</span>
<span>Range Personalizzato</span>
</label>
<div style="display:flex;flex-direction:column;gap:12px">
<div style="display:flex;align-items:center;gap:10px">
<label style="font-size:0.8em;color:#a1a1aa;font-weight:600;min-width:40px">ğŸ“… Da:</label>
<input type="date" id="distribDateFrom" onchange="aggiornaDistribuzione()" style="flex:1;padding:10px 12px;border:2px solid #a1a1aa;border-radius:10px;font-size:0.85em;background:#fff;color:#2c3e50;font-weight:600;cursor:pointer;transition:all 0.3s;box-shadow:0 2px 8px rgba(102,126,234,0.15)" onfocus="this.style.borderColor='#71717a';this.style.boxShadow='0 4px 12px rgba(118,75,162,0.3)'" onblur="this.style.borderColor='#a1a1aa';this.style.boxShadow='0 2px 8px rgba(102,126,234,0.15)'">
</div>
<div style="display:flex;align-items:center;gap:10px">
<label style="font-size:0.8em;color:#a1a1aa;font-weight:600;min-width:40px">ğŸ“… A:</label>
<input type="date" id="distribDateTo" onchange="aggiornaDistribuzione()" style="flex:1;padding:10px 12px;border:2px solid #a1a1aa;border-radius:10px;font-size:0.85em;background:#fff;color:#2c3e50;font-weight:600;cursor:pointer;transition:all 0.3s;box-shadow:0 2px 8px rgba(102,126,234,0.15)" onfocus="this.style.borderColor='#71717a';this.style.boxShadow='0 4px 12px rgba(118,75,162,0.3)'" onblur="this.style.borderColor='#a1a1aa';this.style.boxShadow='0 2px 8px rgba(102,126,234,0.15)'">
</div>
</div>
</div>
</div>

<!-- QUICK ACTIONS -->
<div style="display:grid;grid-template-columns:1fr 1fr;gap:8px;margin-bottom:15px">
<button onclick="setDistribQuick('thisMonth')" style="padding:12px 14px;background:linear-gradient(135deg,#e3f2fd,#bbdefb);border:2px solid #2196f3;color:#1565c0;border-radius:10px;font-size:0.85em;font-weight:700;cursor:pointer;transition:all 0.3s;box-shadow:0 2px 6px rgba(33,150,243,0.2)" ontouchstart="this.style.transform='scale(0.95)'" ontouchend="this.style.transform=''">ğŸ“† Questo Mese</button>
<button onclick="setDistribQuick('last3')" style="padding:12px 14px;background:linear-gradient(135deg,#f3e5f5,#e1bee7);border:2px solid #9c27b0;color:#6a1b9a;border-radius:10px;font-size:0.85em;font-weight:700;cursor:pointer;transition:all 0.3s;box-shadow:0 2px 6px rgba(156,39,176,0.2)" ontouchstart="this.style.transform='scale(0.95)'" ontouchend="this.style.transform=''">ğŸ“… Ultimi 3 Mesi</button>
<button onclick="setDistribQuick('last6')" style="padding:12px 14px;background:linear-gradient(135deg,#fff3e0,#ffe0b2);border:2px solid #ff9800;color:#e65100;border-radius:10px;font-size:0.85em;font-weight:700;cursor:pointer;transition:all 0.3s;box-shadow:0 2px 6px rgba(255,152,0,0.2)" ontouchstart="this.style.transform='scale(0.95)'" ontouchend="this.style.transform=''">ğŸ“Š Ultimi 6 Mesi</button>
<button onclick="setDistribQuick('thisYear')" style="padding:12px 14px;background:linear-gradient(135deg,#e8f5e9,#c8e6c9);border:2px solid #4caf50;color:#2e7d32;border-radius:10px;font-size:0.85em;font-weight:700;cursor:pointer;transition:all 0.3s;box-shadow:0 2px 6px rgba(76,175,80,0.2)" ontouchstart="this.style.transform='scale(0.95)'" ontouchend="this.style.transform=''">ğŸ“† Anno Corrente</button>
</div>

<!-- TITOLO DINAMICO PERIODO -->
<p style="font-size:0.85em;color:#7f8c8d;margin-bottom:12px" id="distribPeriodoDesc">Totale per ogni categoria di spesa</p>

<!-- GRAFICO -->
<div class="chart-container" style="height:480px;overflow-y:auto;-webkit-overflow-scrolling:touch;">
<div id="distribChart"></div>
</div>

<!-- INSIGHTS -->
<div id="distribInsights" style="margin-top:15px;padding:15px;background:linear-gradient(135deg,#e3f2fd,#bbdefb);border-radius:12px;border:2px solid #2196f3">
<h4 style="margin:0 0 12px 0;font-size:1em;color:#1565c0;font-weight:700;text-align:center">ğŸ’¡ Insights</h4>
<div id="distribInsightsContent" style="font-size:0.9em;color:#1565c0;line-height:1.6">
<!-- Popolato dinamicamente -->
</div>
</div>
</div>
</div>

<div id="condiviso" class="section">
<div class="info-box"><strong>ğŸ‘¥ Analisi Spese Condivise</strong><br>Storico completo, grafici e statistiche delle spese condivise con la tua ragazza</div>

<!-- SELECTOR RAPIDO MESE/ANNO -->
<div style="display:flex;justify-content:center;gap:10px;margin-bottom:15px;flex-wrap:wrap">
<button onclick="cambiaCondivisoMese(-1)" style="background:rgba(229,228,226,0.15);border:2px solid rgba(255,140,0,0.6);color:#a1a1aa;box-shadow:0 2px 8px rgba(255,140,0,0.1);padding:12px 18px;border-radius:10px;cursor:pointer;font-weight:700;font-size:0.95em;flex:1;max-width:130px;white-space:nowrap">â—€ Mese Prec</button>
<button id="oggiCondiviso" onclick="vaiOggiCondiviso()" style="background:linear-gradient(135deg,#a1a1aa,#71717a);border:none;color:#fff;padding:12px 18px;border-radius:10px;cursor:pointer;font-weight:700;font-size:0.95em;flex:1;max-width:130px;box-shadow:0 3px 10px rgba(102,126,234,0.4)">ğŸ“… Oggi</button>
<button onclick="cambiaCondivisoMese(1)" style="background:rgba(229,228,226,0.15);border:2px solid rgba(255,140,0,0.6);color:#a1a1aa;box-shadow:0 2px 8px rgba(255,140,0,0.1);padding:12px 18px;border-radius:10px;cursor:pointer;font-weight:700;font-size:0.95em;flex:1;max-width:130px;white-space:nowrap">Mese Succ â–¶</button>
</div>
<div style="text-align:center;font-weight:700;font-size:1.1em;color:#e5e4e2;margin-bottom:15px" id="condivisoMeseDisplay"></div>

<!-- TAB TEMPORALE -->
<div style="display:flex;gap:10px;margin-bottom:20px;justify-content:center">
<button id="tabMensile" class="btn" onclick="mostraTabCondiviso('mensile')" style="flex:1;max-width:200px;background:linear-gradient(135deg,#a1a1aa,#71717a);padding:12px">ğŸ“… Mensile</button>
<button id="tabAnnuale" class="btn" onclick="mostraTabCondiviso('annuale')" style="flex:1;max-width:200px;background:linear-gradient(135deg,#f093fb,#f5576c);padding:12px;opacity:0.6">ğŸ“† Annuale</button>
<button id="tabTotale" class="btn" onclick="mostraTabCondiviso('totale')" style="flex:1;max-width:200px;background:linear-gradient(135deg,#4facfe,#00f2fe);padding:12px;opacity:0.6">ğŸ† Dall'Inizio</button>
</div>

<!-- VISTA MENSILE -->
<div id="condivisoMensile" style="display:block">

<!-- Riepilogo Mese -->
<div class="card">
<h3 style="margin-bottom:15px;font-size:1.2em;text-align:center">ğŸ“Š Riepilogo <span id="condivisoMeseCorrente" style="color:var(--text);font-weight:800"></span></h3>

<div style="display:grid;grid-template-columns:1fr;gap:12px;margin-bottom:15px">
<div style="text-align:center;padding:18px;background:linear-gradient(135deg,#e3f2fd,#bbdefb);border-radius:12px;border:2px solid #2196f3">
<div style="font-size:0.75em;color:#1976d2;font-weight:600;margin-bottom:6px">ğŸ’³ Tue Spese Condivise</div>
<div style="font-size:1.8em;font-weight:800;color:#1565c0;word-break:break-word;line-height:1.2" id="condivisoTueMese">â‚¬0</div>
<div style="font-size:0.7em;color:#1976d2;margin-top:4px" id="condivisoTueTransMese">0 transazioni</div>
</div>
<div style="text-align:center;padding:18px;background:linear-gradient(135deg,#f3e5f5,#e1bee7);border-radius:12px;border:2px solid #9c27b0">
<div style="font-size:0.75em;color:#7b1fa2;font-weight:600;margin-bottom:6px">ğŸ‘¤ Sue Spese Condivise</div>
<div style="font-size:1.8em;font-weight:800;color:#6a1b9a;word-break:break-word;line-height:1.2" id="condivisoSueMese">â‚¬0</div>
<div style="font-size:0.7em;color:#7b1fa2;margin-top:4px" id="condivisoSueTransMese">0 transazioni</div>
</div>
</div>

<div style="text-align:center;padding:18px;background:linear-gradient(135deg,#fff3e0,#ffe0b2);border-radius:12px;border:2px solid #ff9800;margin-bottom:12px">
<div style="font-size:0.75em;color:#e65100;font-weight:600;margin-bottom:6px">ğŸ  Totale Speso Insieme</div>
<div style="font-size:1.9em;font-weight:800;color:#e65100;word-break:break-word;line-height:1.2" id="condivisoTotaleMese">â‚¬0</div>
<div style="font-size:0.7em;color:#e65100;margin-top:4px">Quota per persona: <span id="condivisoQuotaMese">â‚¬0</span></div>
</div>

<div style="text-align:center;padding:18px;border-radius:12px;border:2px solid #4caf50" id="condivisoDaRecMeseCard">
<div style="font-size:0.75em;font-weight:600;margin-bottom:6px" id="condivisoDaRecLabel">ğŸ’° Da Recuperare</div>
<div style="font-size:2.2em;font-weight:800;word-break:break-word;line-height:1.2" id="condivisoDaRecMese">â‚¬0</div>
<div style="font-size:0.75em;margin-top:6px;opacity:0.9;word-break:break-word" id="condivisoDaRecExpl">Spiegazione del calcolo</div>
</div>
</div>

<!-- Top Categorie Condivise Mese -->
<div class="card">
<h3 style="margin-bottom:15px;font-size:1.2em;text-align:center">ğŸ† Top Categorie Condivise</h3>
<div id="condivisoTopCategorieMese"></div>
</div>

</div>

<!-- VISTA ANNUALE -->
<div id="condivisoAnnuale" style="display:none">

<div class="card">
<h3 style="margin-bottom:15px;font-size:1.2em;text-align:center">ğŸ“Š Anno <span id="condivisoAnnoCorrente"></span></h3>

<div style="display:grid;grid-template-columns:1fr;gap:12px;margin-bottom:15px">
<div style="text-align:center;padding:16px;background:linear-gradient(135deg,#e3f2fd,#bbdefb);border-radius:12px">
<div style="font-size:0.75em;color:#1976d2;font-weight:600;margin-bottom:6px">ğŸ’³ Tue Condivise Anno</div>
<div style="font-size:1.8em;font-weight:800;color:#1565c0;word-break:break-word;line-height:1.2" id="condivisoTueAnno">â‚¬0</div>
<div style="font-size:0.7em;color:#1976d2;margin-top:4px">Media: <span id="condivisoTueMediaAnno">â‚¬0</span>/mese</div>
</div>
<div style="text-align:center;padding:16px;background:linear-gradient(135deg,#f3e5f5,#e1bee7);border-radius:12px">
<div style="font-size:0.75em;color:#7b1fa2;font-weight:600;margin-bottom:6px">ğŸ‘¤ Sue Condivise Anno</div>
<div style="font-size:1.8em;font-weight:800;color:#6a1b9a;word-break:break-word;line-height:1.2" id="condivisoSueAnno">â‚¬0</div>
<div style="font-size:0.7em;color:#7b1fa2;margin-top:4px">Media: <span id="condivisoSueMediaAnno">â‚¬0</span>/mese</div>
</div>
</div>

<div style="text-align:center;padding:18px;background:linear-gradient(135deg,#a1a1aa,#71717a);color:#fff;border-radius:12px;margin-bottom:15px">
<div style="font-size:0.75em;opacity:0.9;margin-bottom:6px">ğŸ’° Da Recuperare Anno</div>
<div style="font-size:2em;font-weight:800;word-break:break-word;line-height:1.2" id="condivisoDaRecAnno">â‚¬0</div>
</div>
</div>

<!-- Grafico Trend Annuale -->
<div class="card">
<h3 style="margin-bottom:15px;font-size:1.2em;text-align:center">ğŸ“ˆ Trend Mensile</h3>
<div class="chart-container" style="height:300px">
<canvas id="condivisoTrendChart"></canvas>
</div>
</div>

<!-- Storico Mensile Anno -->
<div class="card">
<h3 style="margin-bottom:15px;font-size:1.2em;text-align:center">ğŸ“… Storico Mese per Mese</h3>
<div id="condivisoStoricoAnno"></div>
</div>

</div>

<!-- VISTA TOTALE -->
<div id="condivisoTotale" style="display:none">

<div class="card">
<h3 style="margin-bottom:15px;font-size:1.2em;text-align:center">ğŸ† Dall'Inizio Tracking <span id="condivisoPeriodoTotale"></span></h3>

<div style="display:grid;grid-template-columns:1fr;gap:12px;margin-bottom:15px">
<div style="text-align:center;padding:16px;background:linear-gradient(135deg,#e3f2fd,#bbdefb);border-radius:12px">
<div style="font-size:0.75em;color:#1976d2;font-weight:600;margin-bottom:6px">ğŸ’³ Hai Pagato</div>
<div style="font-size:2em;font-weight:800;color:#1565c0;word-break:break-word;line-height:1.2" id="condivisoTueTotale">â‚¬0</div>
</div>
<div style="text-align:center;padding:16px;background:linear-gradient(135deg,#f3e5f5,#e1bee7);border-radius:12px">
<div style="font-size:0.75em;color:#7b1fa2;font-weight:600;margin-bottom:6px">ğŸ‘¤ Partner Ha Pagato</div>
<div style="font-size:2em;font-weight:800;color:#6a1b9a;word-break:break-word;line-height:1.2" id="condivisoSueTotale">â‚¬0</div>
</div>
</div>

<div style="text-align:center;padding:18px;background:linear-gradient(135deg,#fff3e0,#ffe0b2);border-radius:12px;margin-bottom:15px">
<div style="font-size:0.75em;color:#e65100;font-weight:600;margin-bottom:6px">ğŸ  Totale Speso Insieme</div>
<div style="font-size:2em;font-weight:800;color:#e65100;word-break:break-word;line-height:1.2" id="condivisoTotaleTotale">â‚¬0</div>
<div style="font-size:0.7em;color:#e65100;margin-top:4px">Quota per persona: <span id="condivisoQuotaTotale">â‚¬0</span></div>
</div>

<div style="text-align:center;padding:20px;background:linear-gradient(135deg,#a1a1aa,#71717a);color:#fff;border-radius:12px;box-shadow:0 8px 24px rgba(102,126,234,0.4)">
<div style="font-size:0.85em;opacity:0.9;margin-bottom:8px">ğŸ’° BILANCIO FINALE</div>
<div style="font-size:2.2em;font-weight:800;word-break:break-word;line-height:1.2" id="condivisoDaRecTotale">â‚¬0</div>
<div style="font-size:0.8em;opacity:0.9;margin-top:6px;word-break:break-word" id="condivisoDaRecTotaleExpl">Chi deve a chi</div>
</div>
</div>

<!-- Grafico Trend Totale -->
<div class="card">
<h3 style="margin-bottom:15px;font-size:1.2em;text-align:center">ğŸ“ˆ Evoluzione "Da Recuperare" nel Tempo</h3>
<p style="font-size:0.85em;color:#7f8c8d;margin-bottom:12px">Andamento cumulativo dal primo mese di tracking</p>
<div class="chart-container" style="height:350px">
<canvas id="condivisoEvoluzioneChart"></canvas>
</div>
</div>

<!-- Top Categorie Totale -->
<div class="card">
<h3 style="margin-bottom:15px;font-size:1.2em;text-align:center">ğŸ† Top Categorie Condivise (Totale)</h3>
<p style="font-size:0.85em;color:#7f8c8d;margin-bottom:12px">Le categorie su cui avete speso di piÃ¹ insieme dall'inizio</p>
<div class="chart-container" style="height:400px">
<canvas id="condivisoTopCategorieChart"></canvas>
</div>
</div>

<!-- Storico Completo -->
<div class="card">
<h3 style="margin-bottom:15px;font-size:1.2em;text-align:center">ğŸ“… Storico Completo</h3>
<p style="font-size:0.85em;color:#7f8c8d;margin-bottom:15px">Dettaglio mese per mese con delta e cumulativo</p>
<div id="condivisoStoricoCompleto" style="overflow-x:auto"></div>
</div>

</div>

</div>

<div id="finanze" class="section">
<div class="info-box"><strong>ğŸ’° Finanze & Analisi</strong><br>Sistema risparmio 15/20/65, previsioni e statistiche dettagliate</div>

<!-- SELECTOR RAPIDO MESE ORO -->
<div style="display:flex;justify-content:center;gap:8px;margin-bottom:8px;margin-top:15px;padding:0 10px">
<button onclick="cambiaFinanzeMese(-1)" style="background:rgba(229,228,226,0.15);border:2px solid rgba(255,140,0,0.6);color:#a1a1aa;padding:12px 16px;border-radius:12px;cursor:pointer;font-weight:700;font-size:0.95em;flex:1;max-width:120px;white-space:nowrap;box-shadow:0 2px 8px rgba(255,140,0,0.1)">â—€ Mese Prec</button>
<button id="oggiFinanze" onclick="vaiOggi()" style="background:linear-gradient(135deg,#a1a1aa,#71717a);border:none;color:#fff;padding:12px 16px;border-radius:12px;cursor:pointer;font-weight:700;font-size:0.95em;flex:1;max-width:120px;box-shadow:0 4px 12px rgba(161,161,170,0.4)">ğŸ“… Oggi</button>
<button onclick="cambiaFinanzeMese(1)" style="background:rgba(229,228,226,0.15);border:2px solid rgba(255,140,0,0.6);color:#a1a1aa;padding:12px 16px;border-radius:12px;cursor:pointer;font-weight:700;font-size:0.95em;flex:1;max-width:120px;white-space:nowrap;box-shadow:0 2px 8px rgba(255,140,0,0.1)">Mese Succ â–¶</button>
</div>

<!-- DATA MESE CORRENTE (SOTTO QUICK SWITCH) -->
<div style="text-align:center;margin-bottom:15px">
<h2 id="finanzeDateHeader" style="font-size:1.1em;font-weight:700;color:#e5e4e2;margin:0"></h2>
</div>

<!-- SISTEMA RISPARMIO 15/20/65 -->
<div class="savings-container">
<div class="savings-title">ğŸ’° Sistema 15/20/65</div>
<div class="savings-subtitle">Dividi le tue entrate in modo equilibrato</div>

<div class="savings-total">
<div class="savings-total-label">Entrate Mese Corrente</div>
<div class="savings-total-value" id="savingsIncome">â‚¬0,00</div>
</div>

<div class="savings-grid">
<div class="savings-bucket">
<div class="savings-bucket-icon">ğŸ¯</div>
<div class="savings-bucket-label">NecessitÃ </div>
<div class="savings-bucket-percent">65%</div>
<div class="savings-bucket-amount" id="savingsNeeds">â‚¬0,00</div>
</div>
<div class="savings-bucket">
<div class="savings-bucket-icon">ğŸ’</div>
<div class="savings-bucket-label">Desideri</div>
<div class="savings-bucket-percent">20%</div>
<div class="savings-bucket-amount" id="savingsWants">â‚¬0,00</div>
</div>
<div class="savings-bucket">
<div class="savings-bucket-icon">ğŸ¦</div>
<div class="savings-bucket-label">Risparmi</div>
<div class="savings-bucket-percent">15%</div>
<div class="savings-bucket-amount" id="savingsSavings">â‚¬0,00</div>
</div>
</div>

<div class="savings-progress">
<div class="savings-progress-label">
<span>Progresso Risparmi</span>
<span id="savingsProgress">0%</span>
</div>
<div class="savings-progress-bar">
<div class="savings-progress-fill" id="savingsProgressBar" style="width:0%"></div>
</div>
</div>
</div>

<!-- ANALISI RISPARMIO MENSILE -->
<div class="card">
<h3 style="margin-bottom:15px;font-size:1.2em;text-align:center">ğŸ“Š Analisi Risparmio Mese</h3>
<div id="savingsAnalysis"></div>
</div>

<!-- PREVISIONI -->
<div class="prediction-card">
<h3 style="margin-bottom:12px;font-size:1.1em;font-weight:800;text-align:center">ğŸ”® Previsione Prossimo Mese</h3>
<div style="display:flex;justify-content:space-around;text-align:center;gap:12px;flex-wrap:wrap">
<div style="flex:1;min-width:140px;padding:10px">
<div style="font-size:0.85em;opacity:0.9;margin-bottom:6px">Spese Previste</div>
<div class="prediction-value" id="predictedExpense">â‚¬0</div>
<div class="prediction-detail" id="predictionTrend"></div>
</div>
<div style="flex:1;min-width:140px;padding:10px">
<div style="font-size:0.85em;opacity:0.9;margin-bottom:6px">Saldo Previsto</div>
<div class="prediction-value" id="predictedBalance">â‚¬0</div>
<div class="prediction-detail" id="predictionNote"></div>
</div>
</div>
</div>

<!-- EVOLUZIONE PATRIMONIO - SEMPLICE -->
<div class="card" style="background:linear-gradient(135deg, rgba(255,215,0,0.1), rgba(255,165,0,0.05));border:2px solid rgba(255,215,0,0.3)">
  <h3 style="margin-bottom:15px;font-size:1.2em;color:#e5e4e2;text-align:center">ğŸ’ Evoluzione Patrimonio</h3>
  
  <!-- Quick Navigation -->
  <div style="display:flex;justify-content:center;gap:8px;margin-bottom:15px">
    <button onclick="cambiaEvoMese(-1)" style="background:rgba(229,228,226,0.15);border:2px solid rgba(255,140,0,0.6);color:#a1a1aa;box-shadow:0 2px 8px rgba(255,140,0,0.1);padding:10px 16px;border-radius:10px;cursor:pointer;font-weight:700;font-size:0.9em;flex:1;max-width:110px">â—€ Prec</button>
    <button onclick="vaiOggiEvo()" style="background:linear-gradient(135deg,#a1a1aa,#71717a);border:none;color:#fff;padding:10px 16px;border-radius:10px;cursor:pointer;font-weight:700;font-size:0.9em;flex:1;max-width:110px;box-shadow:0 3px 10px rgba(102,126,234,0.4)">ğŸ“… Oggi</button>
    <button onclick="cambiaEvoMese(1)" style="background:rgba(229,228,226,0.15);border:2px solid rgba(255,140,0,0.6);color:#a1a1aa;box-shadow:0 2px 8px rgba(255,140,0,0.1);padding:10px 16px;border-radius:10px;cursor:pointer;font-weight:700;font-size:0.9em;flex:1;max-width:110px">Succ â–¶</button>
  </div>
  
  <!-- Data Corrente -->
  <div style="text-align:center;margin-bottom:15px;padding:10px;background:rgba(255,215,0,0.15);border-radius:10px">
    <h3 id="evoDateHeader" style="font-size:1.2em;font-weight:800;color:#e5e4e2;margin:0;text-shadow:0 2px 4px rgba(0,0,0,0.3);text-align:center">Gennaio 2026</h3>
  </div>
  
  <!-- Valore Corrente -->
  <div style="text-align:center;padding:20px;background:rgba(255,215,0,0.08);border-radius:12px;margin-bottom:15px">
    <div style="font-size:0.85em;color:#e5e4e2;margin-bottom:8px;font-weight:600">Patrimonio</div>
    <div id="evoCurrentValue" style="font-size:2em;font-weight:900;color:#e5e4e2">â‚¬0</div>
    <div id="evoCurrentDelta" style="font-size:0.85em;margin-top:8px;font-weight:600">-</div>
  </div>

  <!-- NUOVO - Slider Storico Patrimonio -->
  <div style="background:rgba(255,255,255,0.05);padding:15px;border-radius:12px;margin-bottom:15px">
    <div style="text-align:center;margin-bottom:12px">
      <div style="font-size:0.8em;color:#a1a1aa;margin-bottom:4px">ğŸ• Scorri nel tempo</div>
      <div id="patrimonioSliderData" style="font-size:0.95em;font-weight:700;color:#ffd700">Oggi</div>
    </div>
    <input type="range" id="patrimonioSlider" min="0" max="100" value="100"
      oninput="onSliderPatrimonioChange(this.value)"
      style="width:100%;height:8px;border-radius:4px;background:linear-gradient(90deg,#667eea,#ffd700);cursor:pointer;-webkit-appearance:none;appearance:none">
    <div style="display:flex;justify-content:space-between;margin-top:8px">
      <span style="font-size:0.75em;color:#7f8c8d">Inizio</span>
      <span style="font-size:0.75em;color:#7f8c8d">Oggi</span>
    </div>
    <div style="text-align:center;margin-top:12px;padding:12px;background:rgba(255,215,0,0.1);border-radius:8px">
      <div style="font-size:0.8em;color:#a1a1aa;margin-bottom:4px">Patrimonio a questa data</div>
      <div id="patrimonioSliderDisplay" style="font-size:1.6em;font-weight:800;color:#27ae60">â‚¬0</div>
      <div id="patrimonioSliderDettaglio" style="font-size:0.8em;color:#7f8c8d;margin-top:4px;word-break:break-word">-</div>
    </div>
  </div>

  <!-- Pills Periodo -->
  <div style="display:flex;justify-content:center;gap:8px;margin-bottom:15px">
    <button class="evo-period-btn" data-months="3" onclick="cambiaEvoPeriodo(3)">3M</button>
    <button class="evo-period-btn active" data-months="6" onclick="cambiaEvoPeriodo(6)">6M</button>
    <button class="evo-period-btn" data-months="12" onclick="cambiaEvoPeriodo(12)">1A</button>
  </div>
  
  <!-- Grafico Canvas -->
  <div style="margin-bottom:15px">
    <canvas id="evoChart" height="200"></canvas>
  </div>
  
  <!-- Stats -->
  <div style="display:grid;grid-template-columns:1fr 1fr;gap:12px">
    <div style="background:rgba(255,255,255,0.05);padding:15px;border-radius:10px;text-align:center">
      <div style="font-size:0.8em;opacity:0.8;margin-bottom:6px">Vs Mese Scorso</div>
      <div id="evoStatMonth" style="font-size:1.1em;font-weight:700;color:#e5e4e2">-</div>
    </div>
    <div style="background:rgba(255,255,255,0.05);padding:15px;border-radius:10px;text-align:center">
      <div style="font-size:0.8em;opacity:0.8;margin-bottom:6px">Da Inizio Anno</div>
      <div id="evoStatYear" style="font-size:1.1em;font-weight:700;color:#e5e4e2">-</div>
    </div>
  </div>
</div>

<!-- TABELLE DETTAGLIATE MENSILI (COLLASSABILI) -->
<div class="card">
<div class="collapsible-header" onclick="toggleTabelle()" style="cursor:pointer;padding:18px 15px;background:linear-gradient(135deg,#a1a1aa,#71717a);border-radius:14px;margin-bottom:15px;transition:all 0.3s;box-shadow:0 4px 16px rgba(102,126,234,0.3)">
<div style="display:flex;align-items:center;justify-content:space-between;gap:12px">
<div style="display:flex;align-items:center;gap:12px;flex:1;min-width:0">
<div style="width:42px;height:42px;background:rgba(255,255,255,0.2);border-radius:10px;display:flex;align-items:center;justify-content:center;flex-shrink:0">
<span id="tabelleIcon" style="font-size:1.6em;transition:transform 0.3s;color:#fff;font-weight:700">â–¶</span>
</div>
<div style="flex:1;min-width:0">
<h3 style="margin:0;font-size:1.1em;font-weight:800;color:#fff;margin-bottom:3px">ğŸ“Š Tabelle Dettagliate</h3>
<span style="font-size:0.85em;color:rgba(255,255,255,0.85);font-weight:500">Tutti i mesi dell'anno</span>
</div>
</div>
</div>
</div>

<div id="tabelleContent" style="display:none">
<!-- TABELLE RIEPILOGO ANNUALE -->
<div class="table-container-compact">
<div class="table-header">
<div class="table-title income">ğŸ“ˆ Entrate Mensili</div>
<div class="year-selector">
<button class="year-btn" onclick="cambiaAnnoTabelle(-1)">â—€</button>
<div class="year-display" id="tableYear">2025</div>
<button class="year-btn" onclick="cambiaAnnoTabelle(1)">â–¶</button>
</div>
</div>
<table class="monthly-table">
<thead>
<tr>
<th>Mese</th>
<th>Importo</th>
</tr>
</thead>
<tbody id="incomeTableBody">
<!-- Popolato da JS -->
</tbody>
</table>
<div class="table-footer">
<div class="table-footer-label">Totale Anno</div>
<div class="table-footer-value income" id="incomeTotalYear">â‚¬0,00</div>
</div>
</div>

<div class="table-container-compact">
<div class="table-header">
<div class="table-title expense">ğŸ’¸ Costo Reale Mensile</div>
<div class="year-selector">
<button class="year-btn" onclick="cambiaAnnoTabelle(-1)">â—€</button>
<div class="year-display" id="tableYear2">2025</div>
<button class="year-btn" onclick="cambiaAnnoTabelle(1)">â–¶</button>
</div>
</div>
<table class="monthly-table">
<thead>
<tr>
<th>Mese</th>
<th>Importo</th>
</tr>
</thead>
<tbody id="expenseTableBody">
<!-- Popolato da JS -->
</tbody>
</table>
<div class="table-footer">
<div class="table-footer-label">Totale Anno</div>
<div class="table-footer-value expense" id="expenseTotalYear">â‚¬0,00</div>
</div>
</div>

<div class="table-container-compact">
<div class="table-header">
<div class="table-title savings">ğŸ’° Risparmi Mensili</div>
<div class="year-selector">
<button class="year-btn" onclick="cambiaAnnoTabelle(-1)">â—€</button>
<div class="year-display" id="tableYear3">2025</div>
<button class="year-btn" onclick="cambiaAnnoTabelle(1)">â–¶</button>
</div>
</div>
<table class="monthly-table">
<thead>
<tr>
<th>Mese</th>
<th>Saldo</th>
</tr>
</thead>
<tbody id="savingsTableBody">
<!-- Popolato da JS -->
</tbody>
</table>
<div class="table-footer">
<div class="table-footer-label">Totale Anno</div>
<div class="table-footer-value savings" id="savingsTotalYear">â‚¬0,00</div>
</div>
</div>
</div>
</div>


<!-- RIEPILOGO MESE -->
<div class="card">
<h3 style="margin-bottom:15px;color:#3498db;font-size:1.2em;text-align:center">ğŸ“… Riepilogo Mese <span id="analysisMese" style="color:#3498db;font-weight:800"></span></h3>
<div class="spending-summary">
<div class="summary-box">
<div class="summary-label">ğŸ’¸ Costo Reale</div>
<div style="font-size:0.7em;color:var(--text-muted);margin-top:-2px">(quanto spendi)</div>
<div class="summary-value" id="currentMonthExpense">â‚¬0</div>
</div>
<div class="summary-box income-box">
<div class="summary-label">Entrate Mese</div>
<div class="summary-value" id="currentMonthIncome">â‚¬0</div>
</div>
</div>
</div>

<!-- RIEPILOGO ANNO -->
<div class="card">
<h3 style="margin-bottom:15px;color:var(--expense);font-size:1.2em;text-align:center">ğŸ“… Riepilogo Anno <span id="spendingYear"></span></h3>
<div class="spending-summary">
<div class="summary-box">
<div class="summary-label">Spese Totali</div>
<div class="summary-value" id="totalYearExpense">â‚¬0</div>
<div class="summary-detail" id="avgMonthExpense">Media: â‚¬0/mese</div>
</div>
<div class="summary-box income-box">
<div class="summary-label">Entrate Totali</div>
<div class="summary-value" id="totalYearIncome">â‚¬0</div>
<div class="summary-detail" id="avgMonthIncome">Media: â‚¬0/mese</div>
</div>
</div>
</div>

<!-- COMPARAZIONI PERIODI CON SELEZIONE -->
<div class="card">
<h3 style="margin-bottom:12px;font-size:1.05em;text-align:center;white-space:nowrap;overflow:hidden;text-overflow:ellipsis">ğŸ“Š Confronto Periodi Personalizzato</h3>
<p style="font-size:0.85em;color:var(--text);opacity:0.8;margin-bottom:15px;text-align:center">Seleziona due periodi da confrontare</p>

<!-- Tab Mesi / Anni -->
<div style="display:flex;gap:10px;margin-bottom:20px">
<button id="tabMesi" class="btn" onclick="mostraTabConfronto('mesi')" style="flex:1;background:linear-gradient(135deg,#3498db,#2980b9);padding:14px;font-size:0.95em">ğŸ“… Mesi</button>
<button id="tabAnni" class="btn" onclick="mostraTabConfronto('anni')" style="flex:1;background:linear-gradient(135deg,#9b59b6,#8e44ad);padding:14px;font-size:0.95em;opacity:0.6">ğŸ“† Anni</button>
</div>

<!-- Selettori Mesi -->
<div id="confrontoMesiUI" style="display:block">
<div style="background:var(--bg);padding:15px;border-radius:12px;margin-bottom:15px">

<!-- Primo Mese -->
<div style="margin-bottom:15px;padding:12px;background:linear-gradient(135deg,#e3f2fd,#bbdefb);border-radius:10px;border:2px solid #3498db">
<label style="display:block;margin-bottom:8px;font-weight:700;font-size:0.9em;color:#2980b9;text-align:center">ğŸ”µ Primo Periodo</label>
<div style="display:grid;grid-template-columns:2fr 1fr;gap:8px">
<select id="confrontoMese1" class="controls" style="width:100%;padding:10px;font-size:0.95em">
<option value="0">Gennaio</option>
<option value="1">Febbraio</option>
<option value="2">Marzo</option>
<option value="3">Aprile</option>
<option value="4">Maggio</option>
<option value="5">Giugno</option>
<option value="6">Luglio</option>
<option value="7">Agosto</option>
<option value="8">Settembre</option>
<option value="9">Ottobre</option>
<option value="10">Novembre</option>
<option value="11">Dicembre</option>
</select>
<select id="confrontoAnno1" class="controls" style="width:100%;padding:10px;font-size:0.95em"></select>
</div>
</div>

<!-- VS Divider -->
<div style="text-align:center;font-weight:800;font-size:1.2em;color:var(--text);margin:10px 0">âš¡ VS âš¡</div>

<!-- Secondo Mese -->
<div style="margin-bottom:15px;padding:12px;background:linear-gradient(135deg,#e8f5e9,#c8e6c9);border-radius:10px;border:2px solid #27ae60">
<label style="display:block;margin-bottom:8px;font-weight:700;font-size:0.9em;color:#27ae60;text-align:center">ğŸŸ¢ Secondo Periodo</label>
<div style="display:grid;grid-template-columns:2fr 1fr;gap:8px">
<select id="confrontoMese2" class="controls" style="width:100%;padding:10px;font-size:0.95em">
<option value="0">Gennaio</option>
<option value="1">Febbraio</option>
<option value="2">Marzo</option>
<option value="3">Aprile</option>
<option value="4">Maggio</option>
<option value="5">Giugno</option>
<option value="6">Luglio</option>
<option value="7">Agosto</option>
<option value="8">Settembre</option>
<option value="9">Ottobre</option>
<option value="10">Novembre</option>
<option value="11">Dicembre</option>
</select>
<select id="confrontoAnno2" class="controls" style="width:100%;padding:10px;font-size:0.95em"></select>
</div>
</div>

<button class="btn" onclick="confrontaMesiPersonalizzato()" style="width:100%;background:linear-gradient(135deg,#a1a1aa,#71717a);box-shadow:0 4px 12px rgba(102,126,234,0.3);padding:14px;font-weight:700">
ğŸ” Confronta Periodi
</button>
</div>
</div>

<!-- Selettori Anni -->
<div id="confrontoAnniUI" style="display:none">
<div style="background:var(--bg);padding:15px;border-radius:12px;margin-bottom:15px">

<!-- Primo Anno -->
<div style="margin-bottom:15px;padding:12px;background:linear-gradient(135deg,#f3e5f5,#e1bee7);border-radius:10px;border:2px solid #9b59b6">
<label style="display:block;margin-bottom:8px;font-weight:700;font-size:0.9em;color:#8e44ad;text-align:center">ğŸ”µ Primo Anno</label>
<select id="confrontoAnnoA" class="controls" style="width:100%;padding:10px;font-size:0.95em"></select>
</div>

<!-- VS Divider -->
<div style="text-align:center;font-weight:800;font-size:1.2em;color:var(--text);margin:10px 0">âš¡ VS âš¡</div>

<!-- Secondo Anno -->
<div style="margin-bottom:15px;padding:12px;background:linear-gradient(135deg,#a1a1aa,#71717a);border-radius:10px;border:2px solid #a1a1aa">
<label style="display:block;margin-bottom:8px;font-weight:700;font-size:0.9em;color:#fff;text-align:center">ğŸŸ¢ Secondo Anno</label>
<select id="confrontoAnnoB" class="controls" style="width:100%;padding:10px;font-size:0.95em"></select>
</div>

<button class="btn" onclick="confrontaAnniPersonalizzato()" style="width:100%;background:linear-gradient(135deg,#a1a1aa,#71717a);box-shadow:0 4px 12px rgba(102,126,234,0.3);padding:14px;font-weight:700">
ğŸ” Confronta Anni
</button>
</div>
</div>

<!-- Risultato Confronto -->
<div id="confrontoResult"></div>
</div>


<!-- TENDENZA RISPARMIO MENSILE - CUSTOM DESIGN -->
<div class="card">
<h3 style="margin-bottom:15px;font-size:1.2em;text-align:center">ğŸ’¹ Tendenza Risparmio Mensile</h3>
<p style="font-size:0.9em;color:#7f8c8d;margin-bottom:15px;text-align:center">Percentuale di risparmio per ogni mese (obiettivo: 15%)</p>
<div id="savingsTrendCustom" style="display:grid;grid-template-columns:repeat(3,1fr);gap:10px;margin-bottom:10px"></div>
</div>

<!-- GRAFICO CONFRONTO MENSILE -->
<div class="card">
<h3 style="margin-bottom:15px;font-size:1.2em;text-align:center">ğŸ“Š Confronto Spese Mensili</h3>
<div class="chart-container" style="height:300px">
<canvas id="monthlyExpenseChart"></canvas>
</div>
</div>

<!-- GRAFICO TREND ANNUALE -->
<div class="card">
<h3 style="margin-bottom:15px;font-size:1.2em;text-align:center">ğŸ“ˆ Trend Annuale Entrate vs Uscite</h3>
<div class="chart-container" style="height:300px">
<canvas id="finanzeLineChart"></canvas>
</div>
</div>


</div>

<div id="obiettivi" class="section">
<div class="info-box"><strong>ğŸ¯ Obiettivi Budget</strong><br>Imposta budget mensili per le tue categorie di spesa e monitora i progressi</div>

<!-- SELECTOR RAPIDO MESE (COMPACT HORIZONTAL) -->
<div style="display:flex;justify-content:center;gap:8px;margin-bottom:8px;margin-top:10px">
<button onclick="cambiaObiettiviMese(-1)" style="background:rgba(229,228,226,0.15);border:2px solid rgba(255,140,0,0.6);color:#a1a1aa;box-shadow:0 2px 8px rgba(255,140,0,0.1);padding:12px 16px;border-radius:10px;cursor:pointer;font-weight:700;font-size:0.95em;flex:1;max-width:120px;white-space:nowrap">â—€ Prec</button>
<button id="oggiObiettivi" onclick="vaiOggi()" style="background:linear-gradient(135deg,#a1a1aa,#71717a);border:none;color:#fff;padding:12px 16px;border-radius:10px;cursor:pointer;font-weight:700;font-size:0.95em;flex:1;max-width:120px;box-shadow:0 3px 10px rgba(102,126,234,0.4)">ğŸ“… Oggi</button>
<button onclick="cambiaObiettiviMese(1)" style="background:rgba(229,228,226,0.15);border:2px solid rgba(255,140,0,0.6);color:#a1a1aa;box-shadow:0 2px 8px rgba(255,140,0,0.1);padding:12px 16px;border-radius:10px;cursor:pointer;font-weight:700;font-size:0.95em;flex:1;max-width:120px;white-space:nowrap">Succ â–¶</button>
</div>

<!-- DATA MESE CORRENTE (SOTTO QUICK SWITCH) -->
<div style="text-align:center;margin-bottom:15px">
<h2 id="obiettiviDateHeader" style="font-size:1.1em;font-weight:700;color:#e5e4e2;margin:0"></h2>
</div>

<!-- OBIETTIVI LONG-TERM -->
<div class="card" style="background:linear-gradient(135deg, #fff3e0 0%, #ffe0b2 100%);border:2px solid #ff9800">
<h3 style="margin-bottom:15px;font-size:1.3em;color:#e65100;text-align:center">ğŸ† Obiettivi Long-Term</h3>
<p style="font-size:0.9em;color:#7f8c8d;margin-bottom:20px">I tuoi traguardi di risparmio con date e progressi. Visibili anche sulla Dashboard!</p>

<!-- CapacitÃ  Risparmio -->
<div style="background:rgba(255,255,255,0.95);padding:20px;border-radius:12px;margin-bottom:20px;text-align:center;border:2px solid #ff9800">
<div style="font-size:0.85em;color:#e65100;font-weight:600;margin-bottom:8px">ğŸ’° RISPARMIO MENSILE DISPONIBILE</div>
<div style="font-size:2.5em;font-weight:900;color:#e65100;margin-bottom:6px" id="capacitaRisparmio">â‚¬0</div>
<div style="font-size:0.8em;color:#7f8c8d">Calcolato da: Entrate - Uscite del mese corrente</div>
</div>

<!-- Lista Obiettivi Investimento -->
<div id="obiettiviInvestimentoList" style="margin-bottom:20px">
<!-- SarÃ  popolato via JavaScript -->
</div>

<!-- Proiezioni -->
<div id="proiezioniInvestimenti" style="background:rgba(255,255,255,0.95);border-radius:12px;padding:18px;margin-bottom:15px">
<div style="font-size:1em;font-weight:700;color:#e65100;margin-bottom:15px;text-align:center">ğŸ“Š Proiezioni Temporali</div>
<div id="proiezioniGrid" style="display:grid;grid-template-columns:repeat(2,1fr);gap:12px;margin-bottom:15px">
<!-- SarÃ  popolato via JavaScript -->
</div>
<div style="padding:15px;background:linear-gradient(135deg,#f3e5f5,#e1bee7);border-radius:10px;text-align:center;border:2px solid #9c27b0">
<div style="font-size:0.8em;color:#7b1fa2;font-weight:600;margin-bottom:4px">ğŸ’° Totale Risparmiato</div>
<div style="font-size:1.8em;font-weight:900;color:#7b1fa2" id="totaleRisparmiato">â‚¬0</div>
</div>
</div>

<!-- Pulsanti Gestione -->
<div style="display:grid;grid-template-columns:1fr 1fr;gap:10px">
<button onclick="apriGestioneObiettivi()" class="btn" style="background:linear-gradient(135deg,#ff9800,#f57c00);box-shadow:0 4px 12px rgba(255,152,0,0.3);margin:0">
ğŸ¯ Gestisci Obiettivi
</button>
<button onclick="aggiornaInvestimenti()" class="btn btn-edit" style="margin:0">
ğŸ”„ Aggiorna Dati
</button>
</div>
</div>

<!-- SEPARATOR -->
<div style="height:2px;background:linear-gradient(90deg,transparent,var(--border),transparent);margin:20px 0"></div>

<!-- RIEPILOGO OBIETTIVI -->
<div class="card">
<h3 style="margin-bottom:15px;font-size:1.05em;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;text-align:center">ğŸ“Š Riepilogo Obiettivi <span id="obiettiviMese"></span></h3>
<div id="obiettiviRiepilogo"></div>
</div>

<!-- OBIETTIVI MENSILI -->
<div class="card">
<h3 style="margin-bottom:15px;font-size:1.2em;text-align:center">ğŸ¯ Obiettivi Mensili</h3>
<p style="font-size:0.9em;color:#7f8c8d;margin-bottom:15px;text-align:center">Gestisci i budget mensili per ogni categoria di spesa</p>
<div id="budgetGoals"></div>
<button class="btn" onclick="aggiungiObiettivo()" style="margin-top:15px;padding:14px 20px;font-size:0.95em;white-space:normal;line-height:1.3">
<span style="display:inline">+ Aggiungi Obiettivo Mensile</span>
</button>
</div>

</div>

<div id="trans" class="section">
<div class="info-box"><strong>âœ¨ Transazioni</strong><br>Registra e gestisci le tue transazioni</div>

<!-- Quick Switch Mesi ORO -->
<div style="display:flex;justify-content:center;gap:10px;margin:15px 0">
<button onclick="cambiaMovimentiMese(-1)" style="background:rgba(229,228,226,0.15);border:2px solid rgba(255,140,0,0.6);color:#a1a1aa;box-shadow:0 2px 8px rgba(255,140,0,0.1);padding:12px 18px;border-radius:10px;cursor:pointer;font-weight:700;font-size:0.95em;flex:1;max-width:130px;white-space:nowrap">â—€ Mese Prec</button>
<button id="oggiMovimenti" onclick="vaiOggiMovimenti()" style="background:linear-gradient(135deg,#a1a1aa,#71717a);border:none;color:#fff;padding:12px 18px;border-radius:10px;cursor:pointer;font-weight:700;font-size:0.95em;flex:1;max-width:130px;box-shadow:0 3px 10px rgba(102,126,234,0.4)">ğŸ“… Oggi</button>
<button onclick="cambiaMovimentiMese(1)" style="background:rgba(229,228,226,0.15);border:2px solid rgba(255,140,0,0.6);color:#a1a1aa;box-shadow:0 2px 8px rgba(255,140,0,0.1);padding:12px 18px;border-radius:10px;cursor:pointer;font-weight:700;font-size:0.95em;flex:1;max-width:130px;white-space:nowrap">Mese Succ â–¶</button>
</div>
<div style="text-align:center;font-weight:700;font-size:1.1em;color:#e5e4e2;margin-bottom:15px" id="movimentiMeseCorrente"></div>

<button class="btn" onclick="nuovaTrans()">+ Nuova Transazione</button>
<div class="filters">
<div class="filter-row">
<input type="text" id="searchTrans" placeholder="ğŸ” Cerca..." onkeyup="ricercaDebounced()">
<button id="advancedSearchBtn" onclick="toggleAdvancedSearch()" style="background:linear-gradient(135deg,#a1a1aa,#71717a);color:#fff;border:none;padding:12px 18px;border-radius:12px;cursor:pointer;font-weight:700;white-space:nowrap;box-shadow:0 4px 12px rgba(102,126,234,0.3);transition:all 0.2s" onmouseover="this.style.transform='translateY(-2px)';this.style.boxShadow='0 6px 16px rgba(102,126,234,0.4)'" onmouseout="this.style.transform='';this.style.boxShadow='0 4px 12px rgba(102,126,234,0.3)'">ğŸ” Avanzata</button>
</div>

<div id="advancedSearchPanel" class="advanced-search" style="display:none">
<div style="max-width:600px;margin:0 auto;padding:0 15px">
<div style="background:linear-gradient(135deg,#a1a1aa,#71717a);padding:18px;border-radius:16px;margin:0 0 20px 0;text-align:center">
<h4 style="margin:0;color:#fff;font-size:1.15em;display:inline-flex;align-items:center;gap:10px;font-weight:700">ğŸ” Ricerca Avanzata</h4>
</div>

<!-- PERIODO PERSONALIZZATO -->
<div class="search-section" style="margin-bottom:15px !important;background:var(--card);padding:10px !important;border-radius:12px;box-shadow:0 2px 8px rgba(0,0,0,0.1)">
<div class="search-section-title" style="font-weight:700;margin-bottom:8px !important;color:var(--text);font-size:0.95em !important;display:flex;align-items:center;gap:8px;justify-content:center">ğŸ“… Periodo Personalizzato</div>
<p style="font-size:0.82em !important;color:#7f8c8d;text-align:center;margin-bottom:10px !important">Cerca transazioni in un intervallo di date</p>

<!-- Quick buttons - Vertical layout -->
<div style="display:flex;flex-direction:column;gap:6px;margin-bottom:10px !important">
<button onclick="setQuickPeriod('thisMonth')" style="width:100% !important;padding:10px !important;background:linear-gradient(135deg,#e3f2fd,#bbdefb);border:2px solid #2196f3;color:#1565c0;border-radius:8px;font-size:0.85em !important;font-weight:700;cursor:pointer;box-sizing:border-box">ğŸ“… Mese Corrente</button>
<button onclick="setQuickPeriod('last30')" style="width:100% !important;padding:10px !important;background:linear-gradient(135deg,#f3e5f5,#e1bee7);border:2px solid #9c27b0;color:#6a1b9a;border-radius:8px;font-size:0.85em !important;font-weight:700;cursor:pointer;box-sizing:border-box">ğŸ“Š Ultimi 30 Giorni</button>
<button onclick="setQuickPeriod('thisYear')" style="width:100% !important;padding:10px !important;background:linear-gradient(135deg,#e8f5e9,#c8e6c9);border:2px solid #4caf50;color:#2e7d32;border-radius:8px;font-size:0.85em !important;font-weight:700;cursor:pointer;box-sizing:border-box">ğŸ“† Anno Intero</button>
<button onclick="toggleMonthSelector()" id="monthSelectorBtn" style="width:100% !important;padding:10px !important;background:linear-gradient(135deg,#fff3e0,#ffe0b2);border:2px solid #ff9800;color:#e65100;border-radius:8px;font-size:0.85em !important;font-weight:700;cursor:pointer;box-sizing:border-box">ğŸ“… Scegli Mese â–¼</button>
</div>

<!-- Month selector dropdown (hidden by default) -->
<div id="monthSelectorDropdown" style="display:none;margin-bottom:10px !important;background:rgba(255,152,0,0.05);padding:8px !important;border-radius:8px;border:2px solid #ff9800">
<label style="display:block;font-size:0.85em !important;color:#e65100;margin-bottom:6px !important;font-weight:700;text-align:center">Seleziona Mese e Anno</label>

<!-- Month selector - Vertical -->
<div style="margin-bottom:6px !important">
<label style="display:block;font-size:0.75em !important;color:#7f8c8d;margin-bottom:4px !important;font-weight:600">Mese</label>
<select id="monthSelectorMonth" style="width:100% !important;max-width:100% !important;padding:9px !important;border:2px solid #ff9800;border-radius:8px;font-size:0.85em !important;background:var(--bg);color:var(--text);font-weight:600;box-sizing:border-box !important">
<option value="0">Gennaio</option>
<option value="1">Febbraio</option>
<option value="2">Marzo</option>
<option value="3">Aprile</option>
<option value="4">Maggio</option>
<option value="5">Giugno</option>
<option value="6">Luglio</option>
<option value="7">Agosto</option>
<option value="8">Settembre</option>
<option value="9">Ottobre</option>
<option value="10">Novembre</option>
<option value="11">Dicembre</option>
</select>
</div>

<!-- Year selector - Vertical -->
<div style="margin-bottom:6px !important">
<label style="display:block;font-size:0.75em !important;color:#7f8c8d;margin-bottom:4px !important;font-weight:600">Anno</label>
<select id="monthSelectorYear" style="width:100% !important;max-width:100% !important;padding:9px !important;border:2px solid #ff9800;border-radius:8px;font-size:0.85em !important;background:var(--bg);color:var(--text);font-weight:600;box-sizing:border-box !important">
<!-- Populated dynamically -->
</select>
</div>

<button onclick="applyMonthSelector()" style="width:100% !important;padding:9px !important;background:linear-gradient(135deg,#ff9800,#f57c00);color:#fff;border:none;border-radius:8px;font-weight:700;font-size:0.88em !important;cursor:pointer;box-shadow:0 2px 8px rgba(255,152,0,0.3);box-sizing:border-box">âœ“ Applica</button>
</div>

<!-- Date inputs - Vertical with proper width -->
<div style="margin-bottom:6px !important">
<label style="display:block;font-size:0.78em !important;color:#7f8c8d;margin-bottom:4px !important;font-weight:600">Data inizio</label>
<input type="date" id="searchDateFrom" onchange="mostraTrans()" style="width:100% !important;max-width:100% !important;padding:9px !important;border:2px solid var(--border);border-radius:8px;font-size:0.85em !important;background:var(--bg);color:var(--text);box-sizing:border-box !important;-webkit-appearance:none;-moz-appearance:none;appearance:none">
</div>
<div style="margin-bottom:0 !important">
<label style="display:block;font-size:0.78em !important;color:#7f8c8d;margin-bottom:4px !important;font-weight:600">Data fine</label>
<input type="date" id="searchDateTo" onchange="mostraTrans()" style="width:100% !important;max-width:100% !important;padding:9px !important;border:2px solid var(--border);border-radius:8px;font-size:0.85em !important;background:var(--bg);color:var(--text);box-sizing:border-box !important;-webkit-appearance:none;-moz-appearance:none;appearance:none">
</div>
</div>

<!-- IMPORTO -->
<div class="search-section" style="margin-bottom:15px;background:var(--card);padding:15px;border-radius:12px;box-shadow:0 2px 8px rgba(0,0,0,0.1)">
<div class="search-section-title" style="font-weight:700;margin-bottom:12px;color:var(--text);font-size:1em;display:flex;align-items:center;gap:8px;justify-content:center">ğŸ’° Filtra per Importo</div>
<div style="display:grid;grid-template-columns:1fr 1fr;gap:10px">
<div>
<label style="display:block;font-size:0.85em;color:#7f8c8d;margin-bottom:6px;font-weight:600">â‚¬ Minimo</label>
<input type="number" id="searchAmountMin" placeholder="0" step="0.01" onchange="mostraTrans()" style="width:100%;padding:10px;border:2px solid var(--border);border-radius:8px;font-size:0.9em;background:var(--bg);color:var(--text);box-sizing:border-box">
</div>
<div>
<label style="display:block;font-size:0.85em;color:#7f8c8d;margin-bottom:6px;font-weight:600">â‚¬ Massimo</label>
<input type="number" id="searchAmountMax" placeholder="999999" step="0.01" onchange="mostraTrans()" style="width:100%;padding:10px;border:2px solid var(--border);border-radius:8px;font-size:0.9em;background:var(--bg);color:var(--text);box-sizing:border-box">
</div>
</div>
</div>

<!-- ORDINAMENTO -->
<div class="search-section" style="margin-bottom:15px;background:var(--card);padding:15px;border-radius:12px;box-shadow:0 2px 8px rgba(0,0,0,0.1)">
<div class="search-section-title" style="font-weight:700;margin-bottom:12px;color:var(--text);font-size:1em;display:flex;align-items:center;gap:8px">ğŸ”„ Ordina Risultati</div>
<select id="sortOrder" onchange="cambiaOrdinamento()" style="width:100%;padding:11px;border:2px solid var(--border);border-radius:8px;font-size:0.95em;background:var(--bg);color:var(--text);font-weight:600">
<option value="recenti">ğŸ“… PiÃ¹ recenti (per data)</option>
<option value="ultime-inserite">ğŸ†• Ultime inserite (ordine inserimento)</option>
<option value="vecchie">ğŸ“… PiÃ¹ vecchie (per data)</option>
<option value="a-z">ğŸ”¤ A â†’ Z (Descrizione)</option>
<option value="z-a">ğŸ”¤ Z â†’ A (Descrizione)</option>
<option value="importo-alto">ğŸ’° Importo (alto â†’ basso)</option>
<option value="importo-basso">ğŸ’° Importo (basso â†’ alto)</option>
</select>
</div>

<button onclick="resetAdvancedSearch()" style="width:100%;padding:14px;background:linear-gradient(135deg,#e74c3c,#c0392b);color:#fff;border:none;border-radius:12px;font-weight:700;font-size:1em;cursor:pointer;box-shadow:0 4px 12px rgba(231,76,60,0.3);margin-bottom:0;transition:all 0.2s" onmouseover="this.style.transform='translateY(-2px)';this.style.boxShadow='0 6px 16px rgba(231,76,60,0.4)'" onmouseout="this.style.transform='';this.style.boxShadow='0 4px 12px rgba(231,76,60,0.3)'">ğŸ—‘ï¸ Reset Tutti i Filtri</button>
</div>
</div>


<div class="filter-section-modern">
<label class="filter-label-modern">ğŸ“‹ Visualizzazione</label>
<div class="checkbox-modern">
<input type="checkbox" id="showAllTransactions" onchange="toggleMostraTutte()" class="checkbox-input-modern">
<label for="showAllTransactions" class="checkbox-label-modern">
<span class="checkbox-box-modern"></span>
<span class="checkbox-text-modern">
<span class="checkbox-text-full">Mostra tutte le transazioni (altrimenti solo mensili)</span>
<span class="checkbox-text-short">Mostra tutte (altrimenti mensili)</span>
</span>
</label>
</div>
</div>

<div class="filter-section-modern">
<label class="filter-label-modern">ğŸ” Filtri Rapidi</label>
<div style="display:flex !important;flex-direction:column !important;gap:8px !important;width:100%">
<select id="filterType" onchange="aggFilterCats(); mostraTrans()" class="select-modern" style="width:100% !important;margin:0">
<option value="all">Tutti i tipi</option>
<option value="income">ğŸ“ˆ Entrate</option>
<option value="expense">ğŸ“‰ Uscite</option>
<option value="partner_payment" id="filterTypePartner">ğŸ‘¥ Spesa Partner</option>
</select>
<select id="filterCat" onchange="mostraTrans()" class="select-modern" style="width:100% !important;margin:0">
<option value="all">Tutte le categorie</option>
</select>
<select id="filterMetodo" onchange="mostraTrans()" class="select-modern" style="width:100% !important;margin:0">
<option value="all">Tutti i conti</option>
<!-- Popolato dinamicamente da JavaScript -->
</select>
</div>
</div>

<div class="stats">
<div><div class="label">Transazioni</div><div class="value" id="statsCount">0</div></div>
<div><div class="label">Totale</div><div class="value" id="statsTotal">â‚¬0</div></div>
</div>
</div>
<div id="transList" style="padding:0 2px"></div>
</div>

<div id="cats" class="section">
<div class="info-box"><strong>âš™ï¸ Gestisci Categorie</strong><br>Personalizza le tue categorie e la loro classificazione</div>

<div class="card">
<h3 style="color:var(--income);margin-bottom:15px;font-size:1.2em;text-align:center">ğŸ“ˆ Categorie Entrate</h3>
<div id="catIn"></div>
<button class="btn" onclick="aggCat('income')">+ Aggiungi Entrata</button>
</div>

<div class="card">
<h3 style="color:var(--expense);margin-bottom:15px;font-size:1.2em;text-align:center">ğŸ“‰ Categorie Uscite</h3>
<p style="font-size:0.9em;color:#7f8c8d;margin-bottom:15px">Gestisci le tue categorie di uscita e classificale come NecessitÃ  (65%) o Desideri (20%)</p>

<div style="margin-bottom:20px">
<h4 style="color:#e67e22;margin-bottom:12px;font-size:1em;text-align:center">ğŸ¯ NecessitÃ  (65%)</h4>
<div id="catNecessita"></div>
</div>

<div style="margin-bottom:20px">
<h4 style="color:#9b59b6;margin-bottom:12px;font-size:1em">ğŸ’ Desideri (20%)</h4>
<div id="catDesideri"></div>
</div>

<button class="btn" onclick="aggCatConClassificazione()">+ Aggiungi Uscita</button>
</div>
</div>

<div id="settings" class="section">
<div class="info-box"><strong>ğŸ”§ Impostazioni</strong><br>Gestisci tema, backup e dati</div>

<!-- Profilo Utente (REDESIGNED - piÃ¹ compatto) -->
<div class="card" id="profiloCard">
<h3 style="margin-bottom:15px;font-size:1.1em;text-align:center;display:flex;align-items:center;justify-content:center;gap:8px">
<span>ğŸ‘¥</span> Profilo Utente
</h3>

<!-- Stato attuale compatto -->
<div id="profiloDisplay" style="background:linear-gradient(135deg,#667eea,#764ba2);color:#fff;padding:14px;border-radius:10px;margin-bottom:15px;display:flex;align-items:center;justify-content:space-between">
<div>
<div style="font-size:0.8em;opacity:0.8">ModalitÃ </div>
<div style="font-size:1.2em;font-weight:800" id="profiloModo">ğŸ‘¤ Singolo</div>
</div>
<div style="text-align:right">
<div style="font-size:0.8em;opacity:0.8">Utenti</div>
<div style="font-size:0.95em;font-weight:600" id="profiloNomi">Tu</div>
</div>
</div>

<!-- Bottoni modalitÃ  -->
<div style="display:flex;gap:8px;margin-bottom:15px">
<button class="btn" id="btnSingolo" onclick="cambiaModalita('solo')" style="flex:1;padding:12px;font-size:0.95em">ğŸ‘¤ Singolo</button>
<button class="btn" id="btnCoppia" onclick="cambiaModalita('couple')" style="flex:1;padding:12px;font-size:0.95em">ğŸ‘« Coppia</button>
</div>

<!-- Nomi (solo coppia) -->
<div id="impostazioniCoppia" style="display:none;margin-bottom:15px">
<div style="display:grid;grid-template-columns:1fr 1fr;gap:10px">
<div>
<label style="font-size:0.85em;color:#888;margin-bottom:4px;display:block">Il tuo nome</label>
<input type="text" id="settingsUserName" placeholder="Es: Mario" style="width:100%;padding:12px;border-radius:8px;border:2px solid var(--border);background:var(--bg);color:var(--text);font-size:0.95em">
</div>
<div>
<label style="font-size:0.85em;color:#888;margin-bottom:4px;display:block">Nome partner</label>
<input type="text" id="settingsPartnerName" placeholder="Es: Giulia" style="width:100%;padding:12px;border-radius:8px;border:2px solid var(--border);background:var(--bg);color:var(--text);font-size:0.95em">
</div>
</div>
</div>

<!-- Buoni Pasto compatto -->
<div style="background:rgba(255,152,0,0.08);padding:12px;border-radius:10px;border:2px solid rgba(255,152,0,0.2)">
<div style="font-size:0.9em;font-weight:700;color:#ff9800;margin-bottom:10px;text-align:center">ğŸŸï¸ Buoni Pasto</div>

<div style="display:flex;flex-direction:column;gap:8px">
<!-- User toggle -->
<div style="display:flex;align-items:center;justify-content:space-between;padding:10px;background:var(--bg);border-radius:8px">
<span style="font-weight:600;font-size:0.9em;display:flex;align-items:center;gap:6px">
<span id="buoniUserIcon">ğŸ‘¤</span>
<span id="buoniUserLabel">Tu</span>
</span>
<label style="position:relative;display:inline-block;width:48px;height:24px">
<input type="checkbox" id="buoniUserToggle" checked style="opacity:0;width:0;height:0" onchange="aggiornaBuoniPreview()">
<span style="position:absolute;cursor:pointer;top:0;left:0;right:0;bottom:0;background:#ccc;transition:0.3s;border-radius:24px"></span>
<span class="buoniSlider" style="position:absolute;height:18px;width:18px;left:3px;bottom:3px;background:#fff;transition:0.3s;border-radius:50%"></span>
</label>
</div>

<!-- Partner toggle (solo coppia) -->
<div id="buoniPartnerRow" style="display:none;align-items:center;justify-content:space-between;padding:10px;background:var(--bg);border-radius:8px">
<span style="font-weight:600;font-size:0.9em;display:flex;align-items:center;gap:6px">
<span>ğŸ‘«</span>
<span id="buoniPartnerLabel">Partner</span>
</span>
<label style="position:relative;display:inline-block;width:48px;height:24px">
<input type="checkbox" id="buoniPartnerToggle" style="opacity:0;width:0;height:0" onchange="aggiornaBuoniPreview()">
<span style="position:absolute;cursor:pointer;top:0;left:0;right:0;bottom:0;background:#ccc;transition:0.3s;border-radius:24px"></span>
<span class="buoniSlider" style="position:absolute;height:18px;width:18px;left:3px;bottom:3px;background:#fff;transition:0.3s;border-radius:50%"></span>
</label>
</div>
</div>

<div id="buoniPreview" style="margin-top:8px;padding:8px;background:rgba(255,152,0,0.12);border-radius:6px;font-size:0.8em;text-align:center;color:#ff9800;font-weight:600">
âœ… Buoni attivi per: Tu
</div>
</div>

<button class="btn" onclick="salvaProfilo()" style="margin-top:12px;padding:12px;font-size:0.95em">ğŸ’¾ Salva Profilo</button>
</div>

<div class="card">
<h3 style="margin-bottom:15px;font-size:1.2em;text-align:center">ğŸ“… Data Inizio Tracking</h3>
<div style="background:linear-gradient(135deg,#3498db,#2980b9);color:#fff;padding:20px;border-radius:12px;margin-bottom:15px;text-align:center">
<div style="font-size:0.9em;opacity:0.9;margin-bottom:8px">Stai tracciando dal</div>
<div style="font-size:2em;font-weight:800;margin-bottom:8px" id="trackingDateDisplay">Non impostata</div>
<div style="font-size:0.85em;opacity:0.9" id="trackingDays">Imposta una data per iniziare</div>
</div>
<div class="form-group">
<label style="text-align:center;display:block">Seleziona data di inizio</label>
<input type="date" id="trackingDateInput" style="width:100%;padding:14px;border-radius:10px;border:2px solid var(--border);background:var(--bg);color:var(--text);font-size:1em;text-align:center">
</div>
<button class="btn" onclick="salvaDataTracking()">ğŸ’¾ Salva Data Inizio</button>
<button class="btn btn-edit" onclick="resetDataTracking()">ğŸ”„ Reimposta Data</button>
</div>

<!-- SALDO INIZIALE - Debito pre-esistente con partner (REDESIGNED) -->
<div class="card" id="saldoSplitwiseCard" style="display:none">
<h3 style="margin-bottom:15px;font-size:1.1em;text-align:center;display:flex;align-items:center;justify-content:center;gap:8px">
<span>ğŸ’°</span> Debito Iniziale Condiviso
</h3>

<!-- Vista quando debito giÃ  impostato -->
<div id="debitoGiaImpostato" style="display:none">
<div id="debitoAttualeDisplay" style="padding:16px;border-radius:12px;font-size:1.1em;font-weight:700;text-align:center;margin-bottom:15px;background:rgba(155,89,182,0.1);border:2px solid #9b59b6">
</div>
<div style="display:flex;gap:10px">
<button class="btn" onclick="modificaDebitoIniziale()" style="flex:1;background:linear-gradient(135deg,#3498db,#2980b9)">âœï¸ Modifica</button>
<button class="btn btn-danger" onclick="resetDebitoIniziale()" style="flex:1">ğŸ—‘ï¸ Azzera</button>
</div>
</div>

<!-- Vista per inserire/modificare debito -->
<div id="debitoFormInput" style="display:block">
<div style="background:rgba(155,89,182,0.08);padding:12px;border-radius:10px;margin-bottom:15px;font-size:0.85em;color:#a1a1aa;text-align:center;line-height:1.5">
Hai un debito/credito esistente con <strong id="partnerNameSaldo" style="color:#9b59b6">il partner</strong>?
</div>

<!-- Preview stato attuale -->
<div id="saldoSplitwisePreview" style="padding:14px;border-radius:10px;font-size:1em;font-weight:700;text-align:center;margin-bottom:15px;background:rgba(155,89,182,0.1);border:2px solid rgba(155,89,182,0.3)">
Nessun debito iniziale
</div>

<!-- Input importo compatto -->
<div style="display:flex;align-items:center;gap:10px;margin-bottom:15px">
<div style="display:flex;align-items:center;flex:1;background:var(--bg);border:2px solid rgba(155,89,182,0.3);border-radius:10px;padding:2px">
<span style="padding:10px;font-size:1.2em;font-weight:800;color:#9b59b6">â‚¬</span>
<input type="number" id="saldoSplitwiseIniziale" step="0.01" value="0" oninput="aggiornaPreviewSaldoSplitwise()" style="flex:1;padding:12px 10px;border:none;background:transparent;color:var(--text);font-size:1.3em;text-align:center;font-weight:700;outline:none">
</div>
</div>

<!-- Bottoni Chi deve a chi -->
<div style="display:grid;grid-template-columns:1fr 1fr;gap:10px;margin-bottom:15px">
<button onclick="impostaSaldoSplitwise('positivo')" id="btnMiDeve" style="padding:12px;border-radius:10px;border:2px solid #4ecca3;background:rgba(78,236,163,0.1);color:#4ecca3;font-weight:700;cursor:pointer;font-size:0.9em;display:flex;align-items:center;justify-content:center;gap:6px;transition:all 0.2s">
<span>ğŸ“¥</span> Mi deve
</button>
<button onclick="impostaSaldoSplitwise('negativo')" id="btnDevoIo" style="padding:12px;border-radius:10px;border:2px solid #e74c3c;background:rgba(231,76,60,0.1);color:#e74c3c;font-weight:700;cursor:pointer;font-size:0.9em;display:flex;align-items:center;justify-content:center;gap:6px;transition:all 0.2s">
<span>ğŸ“¤</span> Devo io
</button>
</div>

<!-- Dettagli aggiuntivi (collassabili) -->
<div style="margin-bottom:15px">
<button onclick="toggleDettagliDebito()" id="btnDettagliDebito" style="width:100%;padding:10px;border-radius:8px;border:1px dashed rgba(155,89,182,0.4);background:transparent;color:#9b59b6;font-size:0.85em;cursor:pointer;display:flex;align-items:center;justify-content:center;gap:6px">
<span id="iconDettagliDebito">â–¼</span> Aggiungi dettagli (opzionale)
</button>
<div id="dettagliDebitoContent" style="display:none;margin-top:12px;padding:15px;background:rgba(155,89,182,0.05);border-radius:10px;border:1px solid rgba(155,89,182,0.2)">
<!-- Data riferimento -->
<div style="margin-bottom:12px">
<label style="display:block;font-size:0.8em;color:#9b59b6;margin-bottom:4px;font-weight:600">ğŸ“… Data di riferimento</label>
<input type="date" id="dataDebitoIniziale" style="width:100%;padding:10px;border-radius:8px;border:1px solid rgba(155,89,182,0.3);background:var(--bg);color:var(--text);font-size:0.95em">
</div>
<!-- Nota/Descrizione -->
<div>
<label style="display:block;font-size:0.8em;color:#9b59b6;margin-bottom:4px;font-weight:600">ğŸ“ Nota/Descrizione</label>
<textarea id="notaDebitoIniziale" placeholder="Es: Prestito per vacanza, spese pregresse..." rows="2" style="width:100%;padding:10px;border-radius:8px;border:1px solid rgba(155,89,182,0.3);background:var(--bg);color:var(--text);font-size:0.9em;resize:none"></textarea>
</div>
</div>
</div>

<button class="btn" onclick="salvaSaldoSplitwiseIniziale()" style="width:100%;padding:14px;font-size:1em;font-weight:700;background:linear-gradient(135deg, #9b59b6, #8e44ad)">
ğŸ’¾ Salva Debito Iniziale
</button>

<div style="margin-top:12px;font-size:0.8em;color:#888;text-align:center">
ğŸ’¡ Questo importo verrÃ  aggiunto ai calcoli delle spese condivise
</div>

<!-- Storico modifiche -->
<div id="storicoDebitoContainer" style="display:none;margin-top:15px;padding-top:15px;border-top:1px dashed rgba(155,89,182,0.3)">
<div style="font-size:0.85em;color:#9b59b6;font-weight:600;margin-bottom:10px;display:flex;align-items:center;gap:6px">
<span>ğŸ“œ</span> Storico Modifiche
</div>
<div id="storicoDebitoList" style="max-height:150px;overflow-y:auto;font-size:0.8em"></div>
</div>
</div>
</div>

<!-- NUOVO - Gestione Conti Dinamica (Mockup 2) -->
<div class="card">
<h3 style="margin-bottom:15px;font-size:1.2em;text-align:center">ğŸ’³ Gestione Conti</h3>

<div style="background:rgba(102,126,234,0.1);padding:12px;border-radius:8px;margin-bottom:15px;font-size:0.85em;color:#a1a1aa;text-align:center">
<strong>â„¹ï¸ Info:</strong> Gestisci i tuoi conti di pagamento. Appariranno in tutti i dropdown e nella dashboard.
</div>

<button class="btn" onclick="apriModalAggiuntaConto()" style="width:100%;margin-bottom:15px">
â• Aggiungi Nuovo Conto
</button>

<div style="height:2px;background:var(--border);margin:20px 0"></div>

<!-- Lista Conti -->
<div id="listaContiDinamica">
<!-- Popolato da JavaScript -->
</div>
</div>


<div class="card">
<h3 style="margin-bottom:15px;font-size:1.2em;text-align:center">ğŸ’¾ Gestione Dati</h3>
<button class="btn" onclick="condividiReport()">ğŸ“¤ Condividi Report Mensile</button>
<button class="btn" onclick="esporta()">ğŸ“¥ Esporta Backup JSON</button>
<button class="btn btn-warning" onclick="mostraCSV()">ğŸ“Š Visualizza Dati CSV</button>
<button class="btn btn-edit" onclick="document.getElementById('impFile').click()">ğŸ“¤ Importa Backup</button>
<input type="file" id="impFile" accept=".json" style="display:none" onchange="importa(event)">
<button class="btn btn-danger" onclick="reset()">ğŸ—‘ï¸ Cancella Tutti i Dati</button>
</div>
<div class="card">
<h3 style="margin-bottom:15px;font-size:1.2em;text-align:center">ğŸ”Š Suoni Feedback</h3>
<div style="display:flex;align-items:center;justify-content:space-between;padding:10px;background:var(--bg);border-radius:10px">
<span style="font-weight:600">Attiva suoni</span>
<label style="position:relative;display:inline-block;width:60px;height:34px">
<input type="checkbox" id="soundToggle" onchange="toggleSound()" style="opacity:0;width:0;height:0">
<span style="position:absolute;cursor:pointer;top:0;left:0;right:0;bottom:0;background:#ccc;transition:0.4s;border-radius:34px"></span>
<span id="soundSlider" style="position:absolute;content:'';height:26px;width:26px;left:4px;bottom:4px;background:#fff;transition:0.4s;border-radius:50%"></span>
</label>
</div>
</div>

<div class="card">
<h3 style="margin-bottom:15px;font-size:1.2em;text-align:center">ğŸ” Sicurezza & PIN</h3>
<div style="padding:14px;background:linear-gradient(135deg,#a1a1aa,#71717a);border-radius:12px;margin-bottom:15px;color:#fff">
<div style="text-align:center;margin-bottom:12px">
<div style="font-size:1em;font-weight:700;margin-bottom:4px">ğŸ”’ Blocco con PIN</div>
<div style="font-size:0.85em;opacity:0.9">Proteggi i tuoi dati finanziari</div>
</div>
<div style="display:flex;justify-content:center">
<label style="position:relative;display:inline-block;width:60px;height:34px">
<input type="checkbox" id="biometricToggle" onchange="toggleBiometric()" style="opacity:0;width:0;height:0">
<span style="position:absolute;cursor:pointer;top:0;left:0;right:0;bottom:0;background:rgba(255,255,255,0.3);transition:0.4s;border-radius:34px"></span>
<span id="biometricSlider" style="position:absolute;content:'';height:26px;width:26px;left:4px;bottom:4px;background:#fff;transition:0.4s;border-radius:50%"></span>
</label>
</div>
</div>
<button class="btn" onclick="cambiaPassword()" style="background:#3498db">ğŸ”‘ Cambia PIN di Sicurezza</button>
<button class="btn btn-edit" onclick="testaBiometric()">ğŸ§ª Testa Blocco PIN</button>
<p style="font-size:0.85em;color:#7f8c8d;margin-top:10px;line-height:1.4">
Quando attivo, l'app richiederÃ  un PIN a 6 cifre ogni volta che la apri. PIN predefinito: <code style="background:var(--bg);padding:2px 6px;border-radius:4px;font-weight:700">123456</code>
</p>
</div>
</div>

<div id="widgetFloat" class="widget-float" onclick="nuovaTrans()" style="background:linear-gradient(135deg, #4ecca3 0%, #2ecc71 100%);min-width:60px;padding:15px;text-align:center;">
<div style="font-size:2em;font-weight:900;color:#fff;line-height:1;">+</div>
</div>

<div class="nav">
<div class="nav-item" id="navCondiviso" onclick="vai('condiviso', this)"><div class="nav-icon">ğŸ‘¥</div>Condiviso</div>
<div class="nav-item" onclick="vai('obiettivi', this)"><div class="nav-icon">ğŸ¯</div>Obiettivi</div>
<div class="nav-item" onclick="vai('trans', this)"><div class="nav-icon">ğŸ’³</div>Movimenti</div>
<div class="nav-item active" onclick="vai('dash', this)"><div class="nav-icon">ğŸ“Š</div>Dashboard</div>
<div class="nav-item" onclick="vai('finanze', this)"><div class="nav-icon">ğŸ’°</div>Finanze</div>
<div class="nav-item" onclick="vai('cats', this)"><div class="nav-icon">âš™ï¸</div>Categorie</div>
<div class="nav-item" onclick="vai('settings', this)"><div class="nav-icon">ğŸ”§</div>Impostazioni</div>
</div>

<div id="modal" class="modal">
<div class="modal-content">
<div class="modal-header">
<h3>Nuova Transazione</h3>
<button class="close-btn" onclick="chiudiModal()">&times;</button>
</div>
<form onsubmit="return salva(event);">
<input type="hidden" id="tid">
<div class="form-group">
<label>Data *</label>
<input type="date" id="tdata" required>

</div>
<div class="form-group">
<label>Orario *</label>
<input type="time" id="tora" required>
</div>
<div class="form-group">
<label>Tipo *</label>
<select id="ttipo" onchange="aggCatSel()" required>
<option value="income">ğŸ“ˆ Entrata</option>
<option value="expense">ğŸ“‰ Uscita</option>
</select>
</div>

<!-- Destinazione Conto (per entrate) - SPOSTATO QUI PER ESSERE SUBITO DOPO IL TIPO -->
<div class="form-group" id="destinazioneGroup" style="display:none">
<label>Destinazione Conto *</label>
<select id="tdestinazione" onchange="checkDestinazioneSelezionata()" style="padding:12px;border:2px solid var(--border);border-radius:10px;font-size:1em;background:#2a2a2a;color:var(--text);font-weight:600">
<option value="webank">ğŸ’³ WeBank</option>
<option value="revolut">ğŸŒ Revolut</option>
<option value="paypal">ğŸ’° PayPal</option>
<option value="buoni_pasto" id="optDestBuoni">ğŸŸï¸ Buoni Pasto</option>
<option value="contanti">ğŸ’µ Contanti</option>
</select>
</div>

<!-- NUOVO: Rimborso dal Partner (solo entrate + modalitÃ  coppia) -->
<div class="form-group" id="rimborsoPartnerGroup" style="display:none">
<div onclick="toggleRimborsoPartner()" style="display:flex;align-items:center;gap:12px;cursor:pointer;user-select:none;padding:14px;background:rgba(155,89,182,0.1);border-radius:12px;border:2px solid rgba(155,89,182,0.3);transition:all 0.3s" id="rimborsoPartnerToggle">
<div id="rimborsoCheckbox" style="width:26px;height:26px;border:2px solid #9b59b6;border-radius:8px;display:flex;align-items:center;justify-content:center;background:#fff;flex-shrink:0;transition:all 0.3s">
<span id="rimborsoCheckIcon" style="display:none;font-size:16px;color:#9b59b6;font-weight:900">âœ“</span>
</div>
<input type="checkbox" id="tRimborsoPartner" style="display:none">
<div style="flex:1">
<div style="font-size:1em;font-weight:700;color:#9b59b6">ğŸ’° Rimborso dal Partner</div>
<div style="font-size:0.8em;color:#888;margin-top:3px">Questi soldi riducono il debito che <span id="rimborsoPartnerNome">il partner</span> ha con te</div>
</div>
</div>
</div>

<!-- Dettagli Buoni (solo se destinazione = buoni_pasto) -->
<div id="dettagliBuoniGroup" style="display:none">
<div style="background:#fff3e0;padding:15px;border-radius:10px;border:2px solid #ff9800;margin-bottom:15px">
<h4 style="margin:0 0 12px 0;color:#e65100;font-size:1em">ğŸŸï¸ Dettagli Buoni Pasto</h4>

<div class="form-group">
<label>Numero Buoni</label>
<input type="number" id="tbuoniQuantita" min="1" step="1" value="12" oninput="calcolaImportoBuoni()" style="width:100%;padding:10px;border:2px solid #ff9800;border-radius:8px;font-size:1em;background:var(--bg);color:var(--text)">
</div>

<div class="form-group">
<label>Valore Unitario (â‚¬)</label>
<input type="number" id="tbuoniValore" step="0.01" value="10.50" oninput="calcolaImportoBuoni()" style="width:100%;padding:10px;border:2px solid #ff9800;border-radius:8px;font-size:1em;background:var(--bg);color:var(--text)">
</div>

<div style="background:rgba(255,152,0,0.1);padding:12px;border-radius:8px;margin-top:10px">
<div style="font-size:0.85em;color:#e65100;font-weight:600">ğŸ’° TOTALE CALCOLATO</div>
<div id="tbuoniTotale" style="font-size:1.5em;font-weight:900;color:#e65100;margin-top:4px">â‚¬126.00</div>
</div>
</div>
</div>

<!-- NUOVO - CHI HA PAGATO (solo modalitÃ  coppia) -->
<div class="form-group" id="chiHaPagatoGroup" style="display:none">
<label>Chi ha pagato? *</label>
<div style="display:grid;grid-template-columns:1fr 1fr;gap:12px">
<div class="who-paid-btn" data-who="user" onclick="selezionaChiHaPagato('user', this)" style="padding:14px;background:rgba(255,255,255,0.05);border:2px solid rgba(78,236,163,0.3);border-radius:12px;cursor:pointer;transition:all 0.3s;text-align:center;font-weight:800;color:var(--text)">
<span id="whoPaidUserName">Utente</span>
</div>
<div class="who-paid-btn" data-who="partner" onclick="selezionaChiHaPagato('partner', this)" style="padding:14px;background:rgba(255,255,255,0.05);border:2px solid rgba(78,236,163,0.3);border-radius:12px;cursor:pointer;transition:all 0.3s;text-align:center;font-weight:800;color:var(--text)">
<span id="whoPaidPartnerName">Partner</span>
</div>
</div>
<input type="hidden" id="tchiHaPagato" value="user">
</div>

<!-- Metodo di Pagamento (per uscite) - SPOSTATO QUI: dopo chi ha pagato -->
<div class="form-group" id="metodoPagamentoGroup">
<label>Metodo di Pagamento *</label>
<select id="tmetodo" required onchange="checkMetodoPagamento()" style="padding:12px;border:2px solid var(--border);border-radius:10px;font-size:1em;background:#2a2a2a;color:var(--text);font-weight:600">
<option value="webank">ğŸ’³ WeBank (Principale)</option>
<option value="revolut">ğŸŒ Revolut</option>
<option value="paypal">ğŸ’° PayPal</option>
<option value="buoni_pasto" id="optMetodoBuoni">ğŸŸï¸ Buoni Pasto</option>
<option value="contanti">ğŸ’µ Contanti</option>
</select>
</div>

<div class="form-group" id="categoriaGroup">
<label>Categoria *</label>
<select id="tcat" required></select>
</div>

<div class="form-group" id="importoGroup">
<label>Importo (â‚¬) *</label>
<input type="number" id="timp" step="0.01" min="0.01" required oninput="calcolaDifferenzaMista();calcolaAnticipoPartner()">
</div>

<!-- NUOVA FEATURE: ANTICIPO PARTNER -->
<div class="form-group" id="anticipoPartnerCheckboxGroup" style="display:none">
<div onclick="toggleAnticipoPartner()" style="display:flex;align-items:center;gap:12px;cursor:pointer;user-select:none;padding:15px;background:rgba(255,140,0,0.1);border-radius:12px;border:2px solid rgba(161,161,170,0.3);transition:all 0.3s" id="anticipoPartnerToggle">
<div id="anticipoCheckbox" style="width:28px;height:28px;border:2px solid #a1a1aa;border-radius:8px;display:flex;align-items:center;justify-content:center;background:#fff;flex-shrink:0;transition:all 0.3s">
<span id="anticipoCheckIcon" style="display:none;font-size:18px;color:#a1a1aa;font-weight:900">âœ“</span>
</div>
<input type="checkbox" id="tAnticipoPartner" style="display:none">
<div style="flex:1">
<div style="font-size:1.05em;font-weight:700;color:#a1a1aa">ğŸ’° Include Anticipo per Partner</div>
<div style="font-size:0.85em;color:#999;margin-top:4px">Ho anticipato una parte della spesa per il mio partner</div>
</div>
</div>
</div>

<!-- Sezione Anticipo Partner (nascosta di default) -->
<div id="anticipoPartnerSection" style="display:none">
<div style="background:rgba(229,228,226,0.15);padding:18px;border-radius:12px;border:2px solid rgba(161,161,170,0.4);margin-bottom:15px">
<h4 style="margin:0 0 15px 0;color:#a1a1aa;font-size:1.05em;font-weight:700">ğŸ’° Dettagli Anticipo Partner</h4>

<div style="margin-bottom:15px">
<label style="font-size:0.9em;font-weight:700;color:var(--text);margin-bottom:8px;display:block">Quanto hai anticipato per il partner?</label>
<input type="number" id="tAnticipoImporto" step="0.01" min="0" value="0" oninput="calcolaAnticipoPartner()" style="width:100%;padding:12px;border:2px solid rgba(255,140,0,0.5);border-radius:10px;font-size:1.2em;font-weight:700;background:var(--bg);color:var(--text)">
<div style="font-size:0.8em;color:#999;margin-top:6px">ğŸ’¡ Questo importo sarÃ  scalato dalla tua spesa effettiva</div>
</div>

<!-- Box Calcolo Automatico -->
<div style="background:rgba(255,140,0,0.1);border:2px solid rgba(161,161,170,0.3);border-radius:10px;padding:15px">
<div style="display:flex;justify-content:space-between;align-items:center;padding:8px 0;border-bottom:1px solid rgba(255,140,0,0.2)">
<span style="font-size:0.9em;color:#ccc">Totale pagato</span>
<span style="font-size:1.1em;font-weight:700;color:#e5e4e2" id="anticipoTotalePagato">â‚¬0.00</span>
</div>
<div style="display:flex;justify-content:space-between;align-items:center;padding:8px 0;border-bottom:1px solid rgba(255,140,0,0.2)">
<span style="font-size:0.9em;color:#ccc">Anticipo per partner</span>
<span style="font-size:1.1em;font-weight:700;color:#a1a1aa" id="anticipoImportoPartner">-â‚¬0.00</span>
</div>
<div style="display:flex;justify-content:space-between;align-items:center;padding:12px 0;margin-top:8px;padding-top:15px;border-top:2px solid rgba(161,161,170,0.4)">
<span style="font-size:1em;font-weight:700;color:#e5e4e2">Tua spesa effettiva</span>
<span style="font-size:1.4em;font-weight:900;color:#e5e4e2;text-shadow:0 0 10px rgba(192,192,192,0.3)" id="anticipoSpesaEffettiva">â‚¬0.00</span>
</div>
</div>

<div style="background:rgba(78,236,163,0.1);border:1px solid rgba(78,236,163,0.3);border-radius:8px;padding:12px;margin-top:12px">
<div style="font-size:0.85em;color:#4ecca3;font-weight:600">âœ“ Il saldo condiviso verrÃ  aggiornato automaticamente</div>
<div style="font-size:0.8em;color:#999;margin-top:4px">Hai anticipato per il partner â†’ dovrai recuperare di piÃ¹ (o ridare di meno)</div>
</div>
</div>
</div>

<div class="form-group" id="pagamentoMistoCheckboxGroup">
<div onclick="togglePagamentoMistoCheckbox()" style="display:flex;align-items:center;gap:12px;cursor:pointer;user-select:none;padding:12px;background:var(--bg);border-radius:10px;border:2px solid var(--border);transition:all 0.3s">
<div id="mistoCheckbox" style="width:24px;height:24px;border:2px solid #ff9800;border-radius:6px;display:flex;align-items:center;justify-content:center;background:#fff;flex-shrink:0;transition:all 0.3s">
<span id="mistoCheckIcon" style="display:none;font-size:16px;color:#ff9800;font-weight:900">âœ“</span>
</div>
<input type="checkbox" id="tpagamentoMisto" style="display:none">
<div style="flex:1">
<div style="font-size:1em;font-weight:600;color:var(--text)">ğŸ’³ Pagamento Misto</div>
<div style="font-size:0.8em;color:#7f8c8d;margin-top:4px">Usa buoni + altro metodo (es: 1 buono + â‚¬1.50 carta)</div>
</div>
</div>
</div>

<!-- Sezione Pagamento Misto (nascosta di default) -->
<div id="pagamentoMistoSection" style="display:none">
<div style="background:#fff3e0;padding:15px;border-radius:10px;border:2px solid #ff9800;margin-bottom:15px">
<h4 style="margin:0 0 12px 0;color:#e65100;font-size:1em">Dettagli Pagamento Misto</h4>

<!-- Buoni Pasto -->
<div style="margin-bottom:12px">
<label style="font-size:0.9em;font-weight:700;color:#2c3e50;margin-bottom:6px;display:block">ğŸŸï¸ Buoni Pasto</label>
<input type="number" id="tmistoQuantitaBuoni" min="0" step="1" value="1" oninput="calcolaDifferenzaMista()" style="width:100%;padding:10px;border:2px solid #ff9800;border-radius:8px;font-size:1em;background:var(--bg);color:var(--text)">
<div id="tmistoValoreBuoni" style="font-size:0.8em;color:#7f8c8d;margin-top:4px">1 buono = â‚¬10.50</div>
<div style="font-size:0.75em;color:#7f8c8d;margin-top:2px">Saldo: <span id="tmistoSaldoBuoni">0</span> buoni disponibili</div>
</div>

<!-- Differenza -->
<div style="margin-bottom:12px">
<label style="font-size:0.9em;font-weight:700;color:#2c3e50;margin-bottom:6px;display:block">ğŸ’³ Differenza</label>
<input type="number" id="tmistoDifferenza" step="0.01" readonly style="width:100%;padding:10px;border:2px solid var(--border);border-radius:8px;font-size:1.2em;font-weight:800;background:#ecf0f1;color:#2c3e50">
</div>

<!-- Metodo Differenza -->
<div>
<label style="font-size:0.9em;font-weight:700;color:#2c3e50;margin-bottom:6px;display:block">Pagata con:</label>

<!-- Radio: Mio conto -->
<div onclick="selezionaPagataDa('io')" style="display:flex;align-items:center;gap:10px;padding:10px;background:var(--card);border:2px solid #3498db;border-radius:8px;margin-bottom:8px;cursor:pointer" id="pagataDaIo">
<div id="radioIo" style="width:20px;height:20px;border:2px solid #3498db;border-radius:50%;display:flex;align-items:center;justify-content:center">
<div style="width:10px;height:10px;background:#3498db;border-radius:50%" id="radioIoDot"></div>
</div>
<div style="flex:1">
<div style="font-weight:600;color:var(--text)">Il mio conto</div>
<select id="tmistoMetodoDifferenza" onclick="event.stopPropagation()" style="width:100%;padding:8px;border:1px solid var(--border);border-radius:6px;margin-top:6px;font-size:0.9em;background:var(--bg);color:var(--text)">
<option value="webank">ğŸ’³ WeBank</option>
<option value="revolut">ğŸŒ Revolut</option>
<option value="paypal">ğŸ’° PayPal</option>
<option value="contanti">ğŸ’µ Contanti</option>
</select>
</div>
</div>

<!-- Radio: Partner -->
<div onclick="selezionaPagataDa('partner')" style="display:flex;align-items:center;gap:10px;padding:10px;background:var(--card);border:2px solid var(--border);border-radius:8px;cursor:pointer" id="pagataDaPartner">
<div id="radioPartner" style="width:20px;height:20px;border:2px solid #9c27b0;border-radius:50%;display:flex;align-items:center;justify-content:center">
<div style="width:10px;height:10px;background:#9c27b0;border-radius:50%;display:none" id="radioPartnerDot"></div>
</div>
<div style="font-weight:600;color:var(--text)" id="partnerPagaDifferenzaText">ğŸ‘¤ Partner paga la differenza</div>
</div>
</div>
</div>
</div>

<!-- Calcolo Condivisione (mostrato se pagamento misto + condiviso) -->
<div id="mistoCondivisoCalcolo" style="display:none;margin-bottom:15px;padding:12px;background:rgba(52,152,219,0.1);border:2px solid #3498db;border-radius:8px">
<div style="font-weight:700;margin-bottom:6px;color:#2c3e50;font-size:0.9em">ğŸ“Š Calcolo Condivisione 50/50:</div>
<div id="mistoCondivisoCalcoloContent" style="font-size:0.85em;color:#2c3e50">
<!-- Popolato da JavaScript -->
</div>
</div>

<div class="form-group" id="condivisoCheckboxGroup" style="display:none">
<div onclick="toggleCondivisoCustom()" style="display:flex;align-items:center;gap:12px;cursor:pointer;user-select:none;padding:12px;background:var(--bg);border-radius:10px;border:2px solid var(--border);transition:all 0.3s">
<div id="customCheckbox" style="width:24px;height:24px;border:2px solid var(--income);border-radius:6px;display:flex;align-items:center;justify-content:center;background:#fff;flex-shrink:0;transition:all 0.3s">
<span id="checkIcon" style="display:none;font-size:16px;color:var(--income);font-weight:900">âœ“</span>
</div>
<input type="checkbox" id="tcondiviso" style="display:none">
<div style="flex:1">
<div style="font-size:1em;font-weight:600;color:var(--text)">ğŸ’‘ Spesa condivisa 50/50</div>
<div style="font-size:0.8em;color:#7f8c8d;margin-top:4px">Se attivato, la spesa sarÃ  considerata condivisa. Vedrai quanto recuperare nel dashboard.</div>
</div>
</div>
</div>
<div class="form-group" id="virtualRecoveryGroup" style="display:none">
<div onclick="toggleRecuperoVirtuale()" style="display:flex;align-items:center;gap:12px;cursor:pointer;user-select:none;padding:12px;background:var(--bg);border-radius:10px;border:2px solid var(--border);transition:all 0.3s">
<div id="virtualCheckbox" style="width:24px;height:24px;border:2px solid #9b59b6;border-radius:6px;display:flex;align-items:center;justify-content:center;background:#fff;flex-shrink:0;transition:all 0.3s">
<span id="virtualCheckIcon" style="display:none;font-size:16px;color:#9b59b6;font-weight:900">âœ“</span>
</div>
<input type="checkbox" id="tvirtual" style="display:none">
<div style="flex:1">
<div style="font-size:1em;font-weight:600;color:var(--text)">ğŸ’ Recupero Virtuale</div>
<div style="font-size:0.8em;color:#7f8c8d;margin-top:4px">Traccia la spesa ma usala come pagamento virtuale per ridurre il debito condiviso (non intacca il patrimonio personale)</div>
</div>
</div>
</div>
<div class="form-group">
<label>Note</label>
<textarea id="tnote" rows="3" placeholder="Descrizione opzionale..."></textarea>
</div>
<button type="submit" class="btn">ğŸ’¾ Salva Transazione</button>
<button type="button" class="btn btn-danger" onclick="chiudiModal()">âŒ Annulla</button>
</form>
</div>
</div>

<!-- MODAL BUONI PASTO -->
<div id="modalBuoniPasto" class="modal">
<div class="modal-content" style="max-width:400px">
<h2 style="margin-bottom:20px;text-align:center">ğŸŸï¸ Gestione Buoni Pasto</h2>

<div class="form-group">
<label style="display:block;text-align:center">Numero Buoni Attuali</label>
<input type="number" id="buoniSaldoAttuale" min="0" step="1" value="0" oninput="aggiornaRiepilogoModalBuoni()" style="width:100%;padding:14px;border-radius:10px;border:2px solid #ff9800;background:var(--bg);color:var(--text);font-size:1.2em;font-weight:700;text-align:center">
</div>

<div class="form-group">
<label style="display:block;text-align:center">Valore Unitario (â‚¬)</label>
<input type="number" id="buoniValoreUnitario" step="0.01" min="0.01" value="10.50" oninput="aggiornaRiepilogoModalBuoni()" style="width:100%;padding:14px;border-radius:10px;border:2px solid var(--border);background:var(--bg);color:var(--text);font-size:1em;text-align:center">
</div>

<div style="height:1px;background:var(--border);margin:15px 0"></div>
<div style="font-size:0.9em;color:#7f8c8d;text-align:center;margin-bottom:10px">Impostazioni Mensili</div>

<div class="form-group">
<label style="display:block;text-align:center">Buoni Ricevuti al Mese</label>
<input type="number" id="buoniQuantitaMensile" min="1" step="1" value="12" oninput="aggiornaRiepilogoModalBuoni()" style="width:100%;padding:14px;border-radius:10px;border:2px solid var(--border);background:var(--bg);color:var(--text);font-size:1em;text-align:center">
</div>

<div class="form-group">
<label style="display:block;text-align:center">Giorno Accredito (1-31)</label>
<input type="number" id="buoniGiornoAccredito" min="1" max="31" value="1" style="width:100%;padding:14px;border-radius:10px;border:2px solid var(--border);background:var(--bg);color:var(--text);font-size:1em;text-align:center">
</div>

<div id="buoniRiepilogoModal" style="background:#fff3e0;padding:12px;border-radius:10px;margin:15px 0;text-align:center;border:2px solid #ff9800">
</div>

<button class="btn" onclick="salvaModificaBuoni()" style="width:100%;background:linear-gradient(135deg,#ff9800,#f57c00)">ğŸ’¾ Salva</button>
<button class="btn btn-danger" onclick="chiudiModalBuoni()" style="width:100%;margin-top:10px">âŒ Annulla</button>
</div>
</div>

<!-- MODAL GESTIONE CONTO -->
<div id="modalConto" class="modal">
<div class="modal-content" style="max-width:500px">
<h2 id="modalContoTitolo" style="margin-bottom:20px">â• Aggiungi Conto</h2>
<form onsubmit="salvaConto(event)">
<input type="hidden" id="contoId" value="">

<div class="form-group">
<label>Nome Conto *</label>
<input type="text" id="contoNome" required maxlength="20" placeholder="Es: Postepay" style="width:100%;padding:14px;border-radius:10px;border:2px solid var(--border);background:var(--bg);color:var(--text);font-size:1em">
</div>

<div class="form-group">
<label>Icona *</label>
<div style="background:var(--card);padding:15px;border-radius:10px;border:2px solid var(--border)">
<div style="margin-bottom:10px;font-size:0.85em;color:var(--text);font-weight:600">Clicca per selezionare:</div>
<div id="iconeDisponibili" style="display:grid;grid-template-columns:repeat(auto-fill,minmax(40px,1fr));gap:8px;max-width:100%;overflow:hidden">
<!-- Popolato da JavaScript -->
</div>
<div style="margin-top:10px;padding:10px;background:rgba(102,126,234,0.1);border-radius:8px;text-align:center">
<div style="font-size:0.85em;color:#a1a1aa;margin-bottom:5px">Selezionato:</div>
<div id="iconaSelezionata" style="font-size:2em">â“</div>
</div>
</div>
<input type="hidden" id="contoIcona" required>
</div>

<div class="form-group" id="principaleGroup">
<div onclick="togglePrincipale()" style="display:flex;align-items:center;gap:12px;cursor:pointer;user-select:none;padding:12px;background:var(--bg);border-radius:10px;border:2px solid var(--border)">
<div id="principaleCheckbox" style="width:24px;height:24px;border:2px solid #ffc107;border-radius:6px;display:flex;align-items:center;justify-content:center;background:#fff">
<span id="principaleCheckIcon" style="display:none;font-size:16px;color:#ffc107;font-weight:900">âœ“</span>
</div>
<input type="checkbox" id="contoPrincipale" style="display:none">
<div>
<div style="font-size:1em;font-weight:600;color:var(--text)">â­ Imposta come principale</div>
<div style="font-size:0.8em;color:#7f8c8d;margin-top:4px">Il conto principale sarÃ  evidenziato</div>
</div>
</div>
</div>

<div class="form-group">
<label>ğŸ’° Saldo Attuale (â‚¬)</label>
<input type="number" id="contoSaldoAttuale" step="0.01" value="0" placeholder="Es: 1500" style="width:100%;padding:14px;border-radius:10px;border:2px solid var(--border);background:var(--bg);color:var(--text);font-size:1.1em;font-weight:700;text-align:center">
<div id="infoSaldoCalcolato" style="font-size:0.8em;color:#7f8c8d;margin-top:6px;text-align:center">Modifica per aggiornare il saldo del conto</div>
</div>

<button type="submit" class="btn">ğŸ’¾ Salva</button>
<button type="button" class="btn btn-danger" onclick="chiudiModalConto()">âŒ Annulla</button>
</form>
</div>
</div>

<!-- MODAL DETTAGLIO CATEGORIA -->
<div id="modalCategoriaDettaglio" class="modal">
<div class="modal-content" style="width:95%;max-width:500px;max-height:85vh;overflow:hidden;display:flex;flex-direction:column;margin:auto;border-radius:20px">
<!-- Header compatto -->
<div style="display:flex;justify-content:space-between;align-items:center;padding:16px 18px;background:linear-gradient(135deg,#667eea,#764ba2);border-radius:20px 20px 0 0">
<div style="flex:1;text-align:center">
<h2 id="categoriaDettaglioTitolo" style="margin:0;font-size:1.2em;display:flex;align-items:center;justify-content:center;gap:8px;color:#fff">
<span id="categoriaDettaglioIcona" style="font-size:1.3em"></span>
<span id="categoriaDettaglioNome"></span>
</h2>
<div id="categoriaDettaglioPeriodo" style="font-size:0.8em;color:rgba(255,255,255,0.85);margin-top:4px">ğŸ“… Tutte le transazioni</div>
</div>
<button onclick="chiudiModalCategoriaDettaglio()" style="position:absolute;top:12px;right:12px;background:rgba(255,255,255,0.2);border:none;font-size:1.3em;color:#fff;cursor:pointer;padding:6px 10px;line-height:1;border-radius:50%">âœ•</button>
</div>

<!-- Lista transazioni con scroll fluido -->
<div style="flex:1;overflow-y:auto;padding:14px;background:var(--bg);-webkit-overflow-scrolling:touch">
<div id="categoriaDettaglioTransazioni" style="display:flex;flex-direction:column;gap:10px">
<!-- Popolato da JavaScript -->
</div>
</div>

<!-- Footer con totale -->
<div style="padding:14px 18px;border-top:1px solid var(--border);background:var(--card);border-radius:0 0 20px 20px">
<div style="display:flex;justify-content:space-between;align-items:center">
<div>
<div style="font-size:0.8em;font-weight:600;color:#7f8c8d">ğŸ’° Totale</div>
<div style="font-size:0.75em;color:#999" id="categoriaDettaglioCount">0 transazioni</div>
</div>
<div style="font-size:1.6em;font-weight:900;color:#e74c3c" id="categoriaDettaglioTotale">â‚¬0</div>
</div>
</div>
</div>
</div>

<!-- MODAL CONFERMA PERSONALIZZATO -->
<div id="confirmModal" class="confirm-modal">
<div class="confirm-content">
<div class="confirm-icon" id="confirmIcon">âš ï¸</div>
<div class="confirm-title" id="confirmTitle">Conferma azione</div>
<div class="confirm-message" id="confirmMessage">Sei sicuro di voler procedere?</div>
<div class="confirm-buttons">
<button type="button" class="confirm-btn confirm-btn-cancel" onclick="chiudiConferma(false)">âœ• Annulla</button>
<button type="button" class="confirm-btn confirm-btn-confirm" id="confirmButton" onclick="chiudiConferma(true)">âœ“ Conferma</button>
</div>
</div>
</div>

<!-- MODALE GESTIONE OBIETTIVI -->
<div id="modalObiettivi" class="modal">
<div class="modal-content">
<div class="modal-header" style="background:linear-gradient(135deg, #ff9800 0%, #f57c00 100%);padding:20px;border-radius:16px 16px 0 0">
<h3 style="margin:0;color:#fff;display:flex;align-items:center;gap:10px"><span style="font-size:1.2em">ğŸ†</span> Gestione Obiettivi Long-Term</h3>
<button class="close-btn" onclick="chiudiModalObiettivi()" style="background:rgba(255,255,255,0.2);color:#fff">&times;</button>
</div>

<div style="padding:20px">
<div style="margin-bottom:20px">
<div id="obiettiviListModal" style="max-height:280px;overflow-y:auto">
<!-- Lista obiettivi esistenti -->
</div>
</div>

<button class="btn" onclick="mostraFormNuovoObiettivo()" style="width:100%;background:linear-gradient(135deg,#ff9800,#f57c00)">â• Aggiungi Nuovo Obiettivo</button>

<div id="formNuovoObiettivo" style="display:none;margin-top:20px;padding:20px;background:var(--bg);border-radius:12px;border:2px solid rgba(255,152,0,0.3)">
<h4 style="margin-bottom:15px;color:#e65100;text-align:center">âœ¨ Nuovo Obiettivo</h4>

<div class="form-group" style="text-align:center">
<label style="display:block;text-align:center">Nome Obiettivo *</label>
<input type="text" id="obiettivoNome" placeholder="es: Acconto Casa, Viaggio Giappone..." required style="text-align:center">
</div>

<div class="form-group" style="text-align:center">
<label style="display:block;text-align:center">Icona *</label>
<select id="obiettivoIcona" style="padding:12px;border:2px solid var(--border);border-radius:10px;font-size:1.5em;background:var(--bg);color:var(--text);width:100%;max-width:200px;margin:0 auto;display:block;text-align:center;text-align-last:center">
<option value="ğŸ ">ğŸ  Casa</option>
<option value="ğŸš—">ğŸš— Auto</option>
<option value="ğŸ’">ğŸ’ Matrimonio/Anello</option>
<option value="âœˆï¸">âœˆï¸ Viaggio</option>
<option value="ğŸ’°">ğŸ’° Fondo Emergenze</option>
<option value="ğŸ“š">ğŸ“š Formazione</option>
<option value="ğŸ’»">ğŸ’» Tecnologia</option>
<option value="ğŸ¯">ğŸ¯ Altro</option>
</select>
</div>

<div class="form-group" style="text-align:center">
<label style="display:block;text-align:center">Target (â‚¬) *</label>
<input type="number" id="obiettivoTarget" step="100" min="100" placeholder="es: 20000" required style="text-align:center">
</div>

<div class="form-group" style="text-align:center">
<label style="display:block;text-align:center">GiÃ  Risparmiato (â‚¬)</label>
<input type="number" id="obiettivoRisparmiato" step="100" min="0" value="0" placeholder="es: 8500" style="text-align:center">
</div>

<!-- Campi date - layout verticale per smartphone -->
<div class="form-group" style="text-align:center;margin-bottom:12px">
<label style="display:block;font-size:0.9em;margin-bottom:6px;color:var(--text)">ğŸ“… Data Inizio</label>
<input type="date" id="obiettivoDataInizio" style="width:100%;max-width:280px;margin:0 auto;padding:12px;border:2px solid var(--border);border-radius:10px;background:var(--bg);color:var(--text);text-align:center;display:block;box-sizing:border-box">
</div>
<div class="form-group" style="text-align:center;margin-bottom:15px">
<label style="display:block;font-size:0.9em;margin-bottom:6px;color:var(--text)">ğŸ Data Fine</label>
<input type="date" id="obiettivoDataFine" style="width:100%;max-width:280px;margin:0 auto;padding:12px;border:2px solid var(--border);border-radius:10px;background:var(--bg);color:var(--text);text-align:center;display:block;box-sizing:border-box">
</div>

<div style="background:rgba(255,152,0,0.1);padding:12px;border-radius:8px;margin-bottom:15px;font-size:0.85em;color:#e65100;text-align:center">
ğŸ’¡ Imposta una data fine per vedere le proiezioni!
</div>

<div style="display:flex;gap:10px">
<button class="btn" onclick="salvaObiettivo()" style="flex:2;background:linear-gradient(135deg,#ff9800,#f57c00)">ğŸ’¾ Salva</button>
<button class="btn btn-edit" onclick="annullaFormObiettivo()" style="flex:1">âŒ Annulla</button>
</div>
</div>
</div>
</div>
</div>


<script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
<script src="js/app.js?v=20260126a"></script>
</body>
</html>
